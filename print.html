<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>OpenFoam® Handbook</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="preface.html"><strong aria-hidden="true">1.</strong> Preface</a></li><li class="chapter-item expanded "><a href="intro/index.html"><strong aria-hidden="true">2.</strong> Intro</a></li><li class="chapter-item expanded "><a href="installation/index.html"><strong aria-hidden="true">3.</strong> Installation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="installation/via_package_manager.html"><strong aria-hidden="true">3.1.</strong> Package manager</a></li><li class="chapter-item expanded "><a href="installation/download_binaries.html"><strong aria-hidden="true">3.2.</strong> Precompiled binaries</a></li><li class="chapter-item expanded "><a href="installation/compiling_src_code.html"><strong aria-hidden="true">3.3.</strong> Compiling source code</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="installation/compile_function_objects.html"><strong aria-hidden="true">3.3.1.</strong> Compiling function objects</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="problem_set_up/index.html"><strong aria-hidden="true">4.</strong> Problem set up</a></li><li class="chapter-item expanded "><a href="automation/index.html"><strong aria-hidden="true">5.</strong> Automation </a></li><li><ol class="section"><li class="chapter-item expanded "><a href="automation/run-commands-in-sequence.html"><strong aria-hidden="true">5.1.</strong> Run commands in sequence</a></li><li class="chapter-item expanded "><a href="automation/create-a-custom-command.html"><strong aria-hidden="true">5.2.</strong> Create a custom command</a></li><li class="chapter-item expanded "><a href="automation/bash-script.html"><strong aria-hidden="true">5.3.</strong> Shell scripting</a></li></ol></li><li class="chapter-item expanded "><a href="useful_command/index.html"><strong aria-hidden="true">6.</strong> Useful commands</a></li><li class="chapter-item expanded "><a href="mesh/index.html"><strong aria-hidden="true">7.</strong> Mesh</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="mesh/blockmesh.html"><strong aria-hidden="true">7.1.</strong> blockMesh</a></li><li class="chapter-item expanded "><a href="mesh/snappyhexmesh/index.html"><strong aria-hidden="true">7.2.</strong> snappyHexMesh</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="mesh/snappyhexmesh/advice-for-internal-flow.html"><strong aria-hidden="true">7.2.1.</strong> Internal flow</a></li><li class="chapter-item expanded "><a href="mesh/snappyhexmesh/setting-zones-inside-the-mesh-for-source-terms.html"><strong aria-hidden="true">7.2.2.</strong> Setting zones</a></li><li class="chapter-item expanded "><a href="mesh/snappyhexmesh/multiple_regions.html"><strong aria-hidden="true">7.2.3.</strong> Multiple regions</a></li><li class="chapter-item expanded "><a href="mesh/snappyhexmesh/advanced-refinement-technique.html"><strong aria-hidden="true">7.2.4.</strong> Refinement technique</a></li></ol></li><li class="chapter-item expanded "><a href="mesh/cfmesh.html"><strong aria-hidden="true">7.3.</strong> cfMesh </a></li><li class="chapter-item expanded "><a href="mesh/checkMesh.html"><strong aria-hidden="true">7.4.</strong> checkMesh</a></li><li class="chapter-item expanded "><a href="mesh/ansys-meshing-to-openfoam.html"><strong aria-hidden="true">7.5.</strong> ANSYS Meshing to OpenFoam® </a></li></ol></li><li class="chapter-item expanded "><a href="directories_structure/index.html"><strong aria-hidden="true">8.</strong> Directories’ structure</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="directories_structure/0/index.html"><strong aria-hidden="true">8.1.</strong> 0</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="directories_structure/0/ε-ω-k/index.html"><strong aria-hidden="true">8.1.1.</strong> ε, ω, k</a></li><li class="chapter-item expanded "><a href="directories_structure/0/nut/index.html"><strong aria-hidden="true">8.1.2.</strong> nut</a></li></ol></li><li class="chapter-item expanded "><a href="directories_structure/constant/index.html"><strong aria-hidden="true">8.2.</strong> Constant</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="directories_structure/constant/transportProperties.html"><strong aria-hidden="true">8.2.1.</strong> transportProperties</a></li><li class="chapter-item expanded "><a href="directories_structure/constant/turbulentProperties.html"><strong aria-hidden="true">8.2.2.</strong> turbulentProperties</a></li><li class="chapter-item expanded "><a href="directories_structure/constant/polyMesh.html"><strong aria-hidden="true">8.2.3.</strong> polyMesh</a></li><li class="chapter-item expanded "><a href="directories_structure/constant/thermophysicalProperties.html"><strong aria-hidden="true">8.2.4.</strong> thermophysicalProperties</a></li></ol></li><li class="chapter-item expanded "><a href="directories_structure/system/index.html"><strong aria-hidden="true">8.3.</strong> System</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="directories_structure/system/controldict.html"><strong aria-hidden="true">8.3.1.</strong> controlDict</a></li><li class="chapter-item expanded "><a href="directories_structure/system/fvSchemes.html"><strong aria-hidden="true">8.3.2.</strong> fvSchemes</a></li><li class="chapter-item expanded "><a href="directories_structure/system/fvSolution/fvSolution.html"><strong aria-hidden="true">8.3.3.</strong> fvSolution</a></li><li class="chapter-item expanded "><a href="directories_structure/system/decomposepardict.html"><strong aria-hidden="true">8.3.4.</strong> decomposeParDict</a></li><li class="chapter-item expanded "><a href="directories_structure/system/fvOptions.html"><strong aria-hidden="true">8.3.5.</strong> fvOptions</a></li><li class="chapter-item expanded "><a href="directories_structure/system/topoSetDict.html"><strong aria-hidden="true">8.3.6.</strong> topoSetDict</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="problem-initialization-and-interpolation-from-previous-results/index.html"><strong aria-hidden="true">9.</strong> Problem initialization</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="problem-initialization-and-interpolation-from-previous-results/modularity.html"><strong aria-hidden="true">9.1.</strong> Modularity</a></li></ol></li><li class="chapter-item expanded "><a href="browse-source-code/index.html"><strong aria-hidden="true">10.</strong> Browse Source Code</a></li><li class="chapter-item expanded "><a href="run-in-parallel/index.html"><strong aria-hidden="true">11.</strong> Parallel execution</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="run-in-parallel/MPI.html"><strong aria-hidden="true">11.1.</strong> MPI (Message Passage Interface)</a></li><li class="chapter-item expanded "><a href="run-in-parallel/cluster_practice.html"><strong aria-hidden="true">11.2.</strong> Cluster practices</a></li></ol></li><li class="chapter-item expanded "><a href="compressible-model/compressible-model.html"><strong aria-hidden="true">12.</strong> Compressibility model</a></li><li class="chapter-item expanded "><a href="multiphase-model/index.html"><strong aria-hidden="true">13.</strong> Multiphase model</a></li><li class="chapter-item expanded "><a href="conjugate-heat-transfer-model/index.html"><strong aria-hidden="true">14.</strong> Conjugate Heat Transfer Model</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="conjugate-heat-transfer-model/automation_for_initial_condition.html"><strong aria-hidden="true">14.1.</strong> Boundary condition automation</a></li><li class="chapter-item expanded "><a href="conjugate-heat-transfer-model/not_resolving_fluid_part.html"><strong aria-hidden="true">14.2.</strong> Fluid decoupling</a></li></ol></li><li class="chapter-item expanded "><a href="residuals/index.html"><strong aria-hidden="true">15.</strong> Residuals</a></li><li class="chapter-item expanded "><a href="paraview/paraview.html"><strong aria-hidden="true">16.</strong> ParaView</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="paraview/pvserver.html"><strong aria-hidden="true">16.1.</strong> Remote rendering</a></li><li class="chapter-item expanded "><a href="paraview/compilation.html"><strong aria-hidden="true">16.2.</strong> Compilation</a></li><li class="chapter-item expanded "><a href="paraview/visualization_different_meshes.html"><strong aria-hidden="true">16.3.</strong> Different meshes</a></li></ol></li><li class="chapter-item expanded "><a href="post-processing-via-command-line/index.html"><strong aria-hidden="true">17.</strong> CLI Post-processing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="post-processing-via-command-line/function_object.html"><strong aria-hidden="true">17.1.</strong> Function objects</a></li></ol></li><li class="chapter-item expanded "><a href="PETSc/index.html"><strong aria-hidden="true">18.</strong> External library for computation</a></li><li class="chapter-item expanded "><a href="tools/index.html"><strong aria-hidden="true">19.</strong> Editing tools</a></li><li class="chapter-item expanded "><a href="virtualization/index.html"><strong aria-hidden="true">20.</strong> Virtualization</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="virtualization/WSL.html"><strong aria-hidden="true">20.1.</strong> Windows Subsystem for Linux</a></li><li class="chapter-item expanded "><a href="virtualization/multipass.html"><strong aria-hidden="true">20.2.</strong> Multipass</a></li><li class="chapter-item expanded "><a href="virtualization/docker.html"><strong aria-hidden="true">20.3.</strong> Docker</a></li><li class="chapter-item expanded "><a href="virtualization/docker-compose.html"><strong aria-hidden="true">20.4.</strong> Docker compose</a></li></ol></li><li class="chapter-item expanded "><a href="math_formulation/index.html"><strong aria-hidden="true">21.</strong> Navier Stokes equations </a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OpenFoam® Handbook</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/Adige-Calculations/OpenFOAM-handbook" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <p><a href="https://www.adigecalculations.com/"><img src="images/powered_by_adige.png" alt="title" /></a></p>
<h1 id="preface"><a class="header" href="#preface">Preface</a></h1>
<hr />
<p>This handbook is intended to support a medium/advanced OpenFoam® user
during the usage of the software. It provides commands, explanations,
and extension that we find useful during our CFD workflow, and it is
designed to be used by searching for keywords of an action you wish to
perform within the OpenFoam® framework. This allows you to enrich or
resolve the setting of a problem in the shortest possible time.</p>
<hr />
<h2 id="how-to-interpret-the-text"><a class="header" href="#how-to-interpret-the-text">How to interpret the text:</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Structure</th><th>Meaning</th></tr></thead><tbody>
<tr><td>Abc</td><td>Normal text</td></tr>
<tr><td><code> Abc</code></td><td>Shell command</td></tr>
<tr><td><code>&lt;Abc&gt;</code></td><td>User input required</td></tr>
</tbody></table>
</div>
<h2 id="installation-location"><a class="header" href="#installation-location">Installation location</a></h2>
<p>The entire document will assume the installation has been performedunder the
<code>/opt/OpenFOAM/</code> where there are stored the following files:</p>
<pre><code class="language-sh">.
├── OpenFOAM-v2206
└── ThirdParty-v2206
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("./footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="intro"><a class="header" href="#intro">Intro</a></h1>
<p>OpenFOAM® is free and open-source software, hence everyone can contribute, modify and redistribute it.
The two main distributions of OpenFOAM® actively developed are:</p>
<ul>
<li>OpenFOAM® from the OpenFOAM Foundation</li>
<li>OpenFOAM® by OpenCFD Ltd</li>
</ul>
<p>These are distributed through two differetn web sites, respectively at:</p>
<ul>
<li>https://www.openfoam.org</li>
<li>https://www.openfoam.com</li>
</ul>
<p>This book will cover OpenFOAM® by OpenCFD Ltd which does verison control with the following the nomenclature:</p>
<blockquote>
<p>OpenFOAM-v2312</p>
</blockquote>
<p>Which stands for years followed from the month, i.e. 23 stands for year 2023, while 12 for December. The release cicle occurs
every 6 months.To check the version of OpenFOAM® run, once the sofware is already installed:</p>
<pre><code class="language-sh">foamVersion
</code></pre>
<h2 id="whats-the-difference-between-the-two-main-distributions-of-openfoam"><a class="header" href="#whats-the-difference-between-the-two-main-distributions-of-openfoam">What`s the difference between the two main distributions of OpenFOAM®?</a></h2>
<p>OpenFOAM® by OpenCFD Ltd contains more utilities and they optimise more the mesh generation fuctionality.</p>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>The installation of OpenFoam® is possible through three different methods:</p>
<ul>
<li>Installing the binaries and correlated [dynamic libraries] from a packages manager</li>
<li>Downloading and extracting an pre-compiled package from the OpenFoam® websites</li>
<li>Compiling from the source code</li>
</ul>
<p>In this chapter only pre-compiled installation steps will be covered. For further information on the compilation process refer to
the relative chapter - <a href="installation/../src/17_compile-functionobjects-from-web/README.html">Compilation</a></p>
<h2 id="suggested-location-in-the-linux-file-system"><a class="header" href="#suggested-location-in-the-linux-file-system">Suggested location in the linux file system</a></h2>
<p>If you do not use a package manger, you must choose where to install the software. It
is advised to create a <code>/opt/OpenFOAM/</code> directory if you are not backed up by a package
manager to avoid mistakes during updates. You can create the directory following:</p>
<pre><code class="language-sh">sudo mkdir -p /opt/OpenFOAM
</code></pre>
<p>Where <code>/opt</code> stands for Optional software on file system hierarchy.</p>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation-via-package-manger"><a class="header" href="#installation-via-package-manger">Installation via package manger</a></h1>
<p>This is the simplest method to install software in GNU-Linux, however not all GNU-Linux distributions can take advantage of this method.
The following GNU-Linux distibution are supported:</p>
<ul>
<li>Debian/Ubuntu</li>
<li>openSUSE</li>
<li>CentOS/Fedora</li>
</ul>
<p>To check the description of the package and the dependencies (other software needed to run OpenFoam®) the
software needs:</p>
<pre><code class="language-sh"># It shows the information about OpenFOAM® from the OpenFOAM Foundation
apt show openfoam
</code></pre>
<p>While to point to the package distributed by the OpenCFD Ltd we must install an additional repository.</p>
<pre><code class="language-sh"># Add the repository
curl https://dl.openfoam.com/add-debian-repo.sh | sudo bash

# Show the info for OpenFOAM® by OpenCFD Ltd
apt show openfoam2206-default
</code></pre>
<p>Then install it with super user privileges the package</p>
<pre><code class="language-shell-session">sudo apt install openfoam2206-default
</code></pre>
<p>Then set the binaries/environment variable on the user workspace.</p>
<pre><code class="language-sh">echo "source /usr/lib/openfoam/openfoam2206/OpenFOAM-v2206/etc/bashrc" &gt;&gt; ~/.bashrc
</code></pre>
<p>After the installation, it makes the usage of the software more practical
adding the tutorial functions to the user space in ~/.bashrc :</p>
<pre><code class="language-sh">echo "source ${WM\_PROJECT\_DIR:?}/bin/tools/RunFunctions" &gt;&gt; ~/.bashrc
source ~/.bashrc
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="precompiled-binaries-download"><a class="header" href="#precompiled-binaries-download">Precompiled binaries download</a></h1>
<p>If the packages are not availble for your distribution, download the precompiled binaries instead:</p>
<pre><code class="language-sh">wget https://dl.openfoam.com/source/v2206/OpenFOAM-v2206.tgz -P /opt/OpenFOAM
wget https://dl.openfoam.com/source/v2206/ThirdParty-v2206.tgz -P /opt/OpenFOAM
</code></pre>
<p>These command will download a .tar archive conatining the all necessary file to make the software working on the <code>opt/OpenFOAM</code> directory.
It is advised to use this directory if you are backed up by a package manager to avoid mistakes during future operations or updates.
Next step is to untar these archive with:</p>
<pre><code class="language-sh">cd /opt/OpenFOAM
tar -xvf OpenFOAM-v2206.tgz
tar -xvf ThirdParty-v2206.tgz
</code></pre>
<p>Then set the binaries/environment variables on the user workspace:</p>
<pre><code class="language-sh">echo "source /opt/OpenFOAM/OpenFOAM-v2206/etc/bashrc" &gt;&gt; ~/.bashrc
</code></pre>
<p>After the installation, it makes the usage of the software more practical
adding the tutorial functions to the user space in ~/.bashrc :</p>
<pre><code class="language-sh">echo "source ${WM\_PROJECT\_DIR:?}/bin/tools/RunFunctions" &gt;&gt; ~/.bashrc
source ~/.bashrc
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="compiling-source-code"><a class="header" href="#compiling-source-code">Compiling source code</a></h1>
<p>The source code must be compiled and then added to the execution path, in order to be used. The tool for the
job is <code>wmake</code></p>
<h2 id="wmake"><a class="header" href="#wmake">wmake</a></h2>
<p><code>wmake</code> is a wrapper for <code> make</code>, to improve the compilation
experience. The binary is located at <code>$WM_PROJECT_DIR/wmake</code>.</p>
<h2 id="compiling-the-source-code---x86-architecture-64-bit"><a class="header" href="#compiling-the-source-code---x86-architecture-64-bit">Compiling the source code - x86 architecture (64 bit)</a></h2>
<p>The source code is usually retrieved using <code>git</code> as follows:</p>
<pre><code class="language-sh">git clone https://develop.openfoam.com/Development/openfoam.git /opt/OpenFOAM
git clone https://develop.openfoam.com/Development/ThirdParty-common.git /opt/OpenFOAM
</code></pre>
<p>The previous commands will install the source code and the buils scripts for
third party software in the declared installation directory (<code>/otp/OpenFOAM</code>).
Binaries, libraries, and configuration will be in the same directory.
They will not be separated into different locations as a traditional
UNIX like system would have them. To check if your system has an adequate
environment to start the compilation run:</p>
<pre><code class="language-sh">echo "source /opt/OpenFOAM/OpenFOAM-v2212/etc/bashrc" &gt;&gt; ~/.bashrc
source ~/.bashrc
foamSystemCheck
</code></pre>
<p>If the system check did not produced error messages, then OpenFOAM® can
be compiled. This is done by executing the shell script <code>Allwmake</code> that wrap
the <code>make</code> utilities for automating the compilation.</p>
<pre><code class="language-sh">./Allwmake
</code></pre>
<p>The installation script takes care of all required operations.
Compiling OpenFOAM® can be done by using more than one processor to save
time. In order to do this, an environment variable needs to be set
before running the script to make the programme</p>
<pre><code class="language-sh">export WM\_NCOMPPROCS = 4   ## This export an environment variable to run the compilation in 4 processors
./Allwmake &gt; installation.log
</code></pre>
<p>Or you can directly use all the avilable cores (using the <code>-j</code> flag) to proceed with the compilation:</p>
<pre><code class="language-shell-session">./Allwmake -j -s -q -l &gt; installation.log
</code></pre>
<p>After the source code has been compiled, it makes the usage of the software more practical
adding the common usage binaries to the user space, appending the follwing to <code>~/.bashrc</code> with:</p>
<pre><code class="language-sh">echo "source ${WM\_PROJECT\_DIR:?}/bin/tools/RunFunctions" &gt;&gt; ~/.bashrc
source ~/.bashrc
</code></pre>
<p>OpenFoam® commands should now be recognized by the terminal.</p>
<h2 id="compiling-the-source-code---arm-architecture"><a class="header" href="#compiling-the-source-code---arm-architecture">Compiling the source code - ARM architecture</a></h2>
<p>If the architecture of your machine differ from x86, you need to take few more steps. At first create
a file <code>etc/prefs.sh</code> in the software root directory as shown:</p>
<pre><code class="language-sh">cd /opt/OpenFOAM/OpenFOAM-v2212
echo "WM\_COMPILER=Gcc" &gt; etc/prefs.sh
</code></pre>
<p>Then you have to change two files:</p>
<ul>
<li><code>./wmake/rules/linuxARM7Gcc/cOpt</code></li>
<li><code>./wmake/rules/linuxARM7Gcc/c++Opt</code></li>
</ul>
<p>Substituting the option <code>-mfloat-abi</code> from <code>softfp</code> into <code>hard</code> on the following file using piping:</p>
<pre><code class="language-sh">ls ./wmake/rules/linuxARM7Gcc/cOpt ./wmake/rules/linuxARM7Gcc/c++Opt | xargs sed s/softfp/hard/g
</code></pre>
<p>Then set the binaries/environment variables on the user workspace and start the compilation:</p>
<pre><code class="language-sh">echo "source /opt/OpenFOAM/OpenFOAM-v2212/etc/bashrc" &gt;&gt; ~/.bashrc
./Allwmake -j -s -l
</code></pre>
<h2 id="scheduling-compilation-hpc-environment"><a class="header" href="#scheduling-compilation-hpc-environment">Scheduling compilation (HPC environment)</a></h2>
<p>In case of an HPC installation you can schedule
the installation with a shell script similar to the following one:</p>
<pre><code class="language-sh">#!/bin/bash
#SBATCH --job-name=OpenFOAM-compilation
#SBATCH --ntasks=36
#SBATCH --output=%x_%j.out
#SBATCH --partition=compute
#SBATCH --constraint=c5n.18xlarge

## -- Loading the env. variables, for putting in scope the mpi utilities  -- #
module load openmpi

source /opt/OpenFOAM/OpenFOAM-v2212/etc/bashrc
export WM_NCOMPPROCS=36
cd /opt/OpenFOAM/OpenFOAM-v2212
./Allwmake &gt; installation.log
</code></pre>
<p>This script uses 36 cores, correspondent to a 1 nodes of the HPC on study ("c5n.18xlarge") made
by 36 cores each. The job should compile in few minutes.
The location of the source code is different (than the advised location) because the software is
installed on a shared file system for distribution purpose.</p>
<h2 id="usual-problems"><a class="header" href="#usual-problems">Usual problems</a></h2>
<p>Several distribution may need some libraries, and correct callings to make the system working.
To compile OpenFOAM, the shared library of an MPI implementation must be set in the exectution path:</p>
<pre><code class="language-sh">export PATH=$PATH:/usr/lib64/openmpi/bin
source /usr/lib/openfoam/openfoam2312/etc/bashrc
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="compile-functionobjects"><a class="header" href="#compile-functionobjects">Compile functionObjects</a></h1>
<p>Once you are in possess of the source files (<code>.c</code> and <code>.h</code>) of the objectFunction.
A new directory must be added at <code>$FOAM_SRC/functionObject/…/</code>.</p>
<blockquote>
<p>i.g. a Reynolds number custom functionObject files should be added in this plausible directory</p>
</blockquote>
<ul>
<li><code>$FOAM_SRC/functionObject/field/ReynoldsNo</code></li>
</ul>
<p>Then compiler instruction must be added in this case in:</p>
<pre><code class="language-sh">echo "ReynoldsNo/ReynodsNo.c" &gt;&gt;  $FOAM_SRC/functionObjects/field/Make/files
</code></pre>
<p>Then run from parent directory of the application you have changed (i.e. $FOAM_SRC/functionObject/field in this case) the command</p>
<pre><code class="language-sh">wmake
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="case-set-up"><a class="header" href="#case-set-up">Case set up</a></h1>
<p>The usual workflows to set up a case is to lay the foundation on similar tutorial.
Hence, you need to select an appropriate solver for the problem, a way for listing
the application areas is with:</p>
<pre><code class="language-shell-session">ls $FOAM_SOLVERS
</code></pre>
<p>Once it is decided a solver, take a suitable tutorial case, copy it to your working directory.</p>
<pre><code class="language-sh">mkdir -p $FOAM_RUN                # if you do not have a working directory
cp -r $FOAM_TUTORIALS/&lt;\tutorial\&gt; $FOAM_RUN
</code></pre>
<p>Modify the tutorial, including geometry, meshing and problem setup is crucial and often
you need to introduce a dictionary tat was not present in the original turotial file. The
following utility will create the dictionary for you:</p>
<pre><code class="language-shell-session">foamGetDict &lt;\dictionary you want in your case\&gt;
</code></pre>
<p>For instance:</p>
<pre><code class="language-sh">foamGetDict topoSetDict
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="automation"><a class="header" href="#automation">Automation</a></h1>
<p>Being OpenFOAM® a heavily programmable software built in a heavy programmable system,
there is the possiblity to automate most of your routine for the usual CFD workflow.
Usually three action are taken to automate actions:</p>
<ul>
<li>run commands in sequence</li>
<li>create custom commands</li>
<li>create script to execute</li>
</ul>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="execute-unix-commands-in-sequence"><a class="header" href="#execute-unix-commands-in-sequence">Execute UNIX commands in sequence</a></h1>
<p>The sequence of commands are a must to learn to be effective on the keyboard.</p>
<p>Command 2 (i.e. snappyHexMesh) will start only if command 1 (blockMesh) has succeeded:</p>
<pre><code class="language-sh">blockMesh &amp;&amp; snappyHexMesh
</code></pre>
<p>Using the colon <code>;</code> permit to run command in sequence even if the precedent has failed.</p>
<pre><code class="language-sh">blockMesh; snappyHexMesh
</code></pre>
<p>Piping commands using <code>|</code>. Feed the output of command 1 in command 2 as argument, as example:</p>
<pre><code class="language-sh">ls | grep foo
</code></pre>
<p>where <code>ls</code> list the files/directory in the current directory and <code>grep</code> will retun the
a list of file which contain a the pattern <code>foo</code> in their name.</p>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create-a-custom-command"><a class="header" href="#create-a-custom-command">Create a custom command</a></h1>
<p>To create a personalized command (alias), if you are using bash as a OS shell like
in most of the UNIX like system, do:</p>
<pre><code class="language-sh">echo "alias &lt;\nameCommand\&gt;=’&lt;\list of command you want execute digiting
nameCommand\&gt;" &gt;&gt; ~/.bashrc’
</code></pre>
<p>to write at the end of your shell config file the alias you prefer.
For example, a useful alias which create a dummy file with the name of
the directory and then open ParaView in series is declared as following:</p>
<pre><code class="language-sh">alias paraview_openFoam ='touch "${PWD\#\#\*/}".foam &amp;&amp; paraview "${PWD\#\#\*/}".foam
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="shell-scripting"><a class="header" href="#shell-scripting">Shell scripting</a></h1>
<p>These are script files, for running all the commands related to the
case. You can open it using any editor and see the commands executed from it.
Taking as example the native bash script often present in tutorial
cases <code>Allrun</code> and <code>Allclean</code>, the follwing command will execute them:</p>
<pre><code class="language-sh">./Allrun
</code></pre>
<p>It will run all the command necessary to run the tutorial. While:</p>
<pre><code class="language-sh">./Allclean
</code></pre>
<p>It will run all the command necessary to clean the tutorial.</p>
<h2 id="custom-script"><a class="header" href="#custom-script">Custom script</a></h2>
<p>To write your shell script, start a new file with the notation:</p>
<pre><code class="language-bash">#!/bin/bash
</code></pre>
<p>then followed by the command you want to execute.
Elevate the file permission adding execution permission through</p>
<pre><code class="language-sh">chmod +x shellScript.sh
</code></pre>
<p>For running your bash script, type:</p>
<pre><code class="language-sh">./shellScript.sh
</code></pre>
<p>An example of a bash script to automate a thermal analysis is presented here:</p>
<pre><code class="language-sh">#!/bin/bash

SLURM_NTASKS=16                                          # Processor number defined here 
source ${WM_PROJECT_DIR:?}/bin/tools/RunFunctions        # Source run functions

# Remove previous log directory for job monitoring and previous run file
./Allclean
rm -r log;
mkdir log

# Mesh generation
restore0Dir
surfaceFeatureExtract                                       &gt; ./log/surfaceFeatureExtract.log  2&gt;&amp;1  &amp;&amp; echo "surfaceFeatureExtract Executed/n"
blockMesh                                                   &gt; ./log/blockMesh.log 2&gt;&amp;1  &amp;&amp; echo "blockMesh Executed"
decomposePar -force                                         &gt; ./log/decomposePar1.log 2&gt;&amp;1  &amp;&amp; echo "decomposePar1 Executed"
mpirun -np $SLURM_NTASKS snappyHexMesh -parallel -overwrite &gt; ./log/snappyHexMesh.log 2&gt;&amp;1 &amp;&amp; echo "snappyHexMesh Executed"

# Addional mesh zones operation
reconstructParMesh -constant                                &gt; ./log/reconstructParMesh1         2&gt;&amp;1 &amp;&amp; echo "Reconstruct Case"
topoSet                                                     &gt; ./log/topoSet  &amp;&amp; echo "topoSet Executed"
checkMesh                                                   &gt; ./log/checkMesh.log                   2&gt;&amp;1 &amp;&amp; echo "checkMesh Executed"

decomposePar -force                                         &gt; ./log/decomposePar2 2&gt;&amp;1 &amp;&amp; echo "decomposePar2 Executed"
mpirun -np $SLURM_NTASKS $(getApplication) -parallel        &gt; ./log/$(getApplication).log 2&gt;&amp;1 &amp;&amp; echo "$(getApplication) Executed"

reconstructParMesh -constant -allRegions                    &gt; ./log/reconstructParMesh.log 2&gt;&amp;1 &amp;&amp; echo "Finished"
</code></pre>
<h2 id="parametric-study"><a class="header" href="#parametric-study">Parametric study</a></h2>
<p>To develop a parametric study, hence you change one or more  variables to get the consequent result
of this boudnary conditions change. You can use the <code>sed</code> command to drive the dictionary changes:</p>
<pre><code class="language-sh">sed -i '/^[[:space:]]*massFlowRate/c\ massFlowRate 1000;'  0/U
</code></pre>
<p>This above command substitute the row that contain the word "massFlowRate" with the follwing: "massFlowRate 1000;".
Creating a bash script to automate this practise will look similar to the following:</p>
<pre><code class="language-sh">#!/bin/bash

SLURM_NTASKS=14
list_mass_flow_rate=(1.14E-04  2.29E-04  3.43E-04)

# Source run functions
source ${WM_PROJECT_DIR:?}/bin/tools/RunFunctions        
rm -r log;
mkdir log

# Build the mesh
surfaceFeatureExtract &gt; ./log/surfaceFeatureExtract.log 2&gt;&amp;1  &amp;&amp; echo "surfaceFeatureExtract Executed/n"
blockMesh  &gt; ./log/blockMesh.log 2&gt;&amp;1  &amp;&amp; echo "blockMesh Executed"
decomposePar -force  &gt; ./log/decomposePar1.log 2&gt;&amp;1 &amp;&amp; echo "decomposePar1 Executed"
mpirun -np $SLURM_NTASKS snappyHexMesh -parallel -overwrite &gt; ./log/snappyHexMesh.log 2&gt;&amp;1 &amp;&amp; echo "snappyHexMesh Executed"
mpirun -np $SLURM_NTASKS checkMesh -parallel &gt; ./log/checkMesh.log 2&gt;&amp;1 &amp;&amp; echo "checkMesh Executed"
reconstructParMesh -constant &gt; ./reconstructParMesh.log 2&gt;&amp;1 &amp;&amp; echo "reconstructParMesh Executed"


for flowRateValue in "${list_mass_flow_rate[@]}"
do
        rm -r process*;

        # Modify the 0/U directory with a new value of massflow rate
        sed -i "/^[[:space:]]*massFlowRate/c\ massFlowRate $flowRateValue ;"  0.orig/U  &amp;&amp; echo "Changed 0/U with $flowRateValue kg/s"
        restore0Dir &gt; ./log/restore0Dir.$flowRateValue.log 2&gt;&amp;1 &amp;&amp; echo "restore0Dir $flowRateValue  Executed"
        decomposePar -force &gt; ./log/decomposePar.$flowRateValue.log 2&gt;&amp;1 &amp;&amp; echo "decomposePar $flowRateValue  Executed"
        mpirun -np $SLURM_NTASKS $(getApplication) -parallel   &gt; ./log/$(getApplication).$flowRateValue.log 2&gt;&amp;1 &amp;&amp; echo "$(getApplication) $flowRateValue Executed"
        reconstructPar -latestTime &gt; ./log/reconstructParMesh.$flowRateValue.log 2&gt;&amp;1  &amp;&amp; echo "reconstructPar $flowRateValue Executed"

        # Take the newly created directory and re-name it as the flow rate
        mv $(ls -1tr | tail -1) $flowRateValue
done
</code></pre>
<h2 id="find-bugs"><a class="header" href="#find-bugs">Find bugs</a></h2>
<p>The utility <code>shellcheck</code> provide warnings and suggestions for bash/sh
shell scripts. Run the following for instant output:</p>
<pre><code class="language-sh">shellcheck yourscript.sh
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="useful-command"><a class="header" href="#useful-command">Useful command</a></h1>
<p>A list comprised of a brief description of few usueful command is given.</p>
<h2 id="grep"><a class="header" href="#grep"><code>grep</code></a></h2>
<p>It will search word patterns for you in selected documents or a list of them</p>
<pre><code class="language-sh">grep -w -R "foo"
</code></pre>
<p>where the <code>-w</code> flag stands for word while <code>-R</code> for research in subdirectories.
It will search all the file names that in which he finds a pattern (in this case:
<code>foo</code>).</p>
<h2 id="mmv"><a class="header" href="#mmv"><code>mmv</code></a></h2>
<p>Rename more than one file at once, extension included:</p>
<pre><code class="language-sh">mmv '\*.STL' '\#1.stl'
</code></pre>
<h2 id="tail"><a class="header" href="#tail"><code>tail</code></a></h2>
<p>To check running simulation written in a log file, it is possible to see
in terminal the live writing</p>
<pre><code class="language-sh">tail -f  foo.log
</code></pre>
<h2 id="sed"><a class="header" href="#sed"><code>sed</code></a></h2>
<p>For replacing the text repetitively in file stream:</p>
<pre><code class="language-sh">find . -type f | xargs sed -i s/&lt;oldWord&gt;/&lt;newWord&gt;/g
</code></pre>
<p>The above chains of commands  will change the content of every file that constains an
<code>oldWorld</code> pattern substituting it with <code>newWord</code>.</p>
<h2 id="cp"><a class="header" href="#cp"><code>cp</code></a></h2>
<p>A useful usage of the copy utility follows.
for example, to copy a file in different directory, execute:</p>
<pre><code class="language-sh">ls -d processor* | xargs -i cp -r 0.orig/* ./{}/0
</code></pre>
<h2 id="find"><a class="header" href="#find"><code>find</code></a></h2>
<p>To find the correct case frame in tutorial, follows simlar commands chain:</p>
<pre><code class="language-sh">find $FOAM_TUTORIALS -type f | xargs grep -r &lt;wordYouAreInterestedIn&gt;              # It will search in all tutorial files 
find $FOAM_TUTORIALS -name controlDict | xargs grep -r &lt;wordYouAreInterestedIn&gt;    # It will search in all controlDict files
</code></pre>
<p>Which list controlDict files where the word <code>foo</code> have been found</p>
<p>If you want to know how the continuity errors are computed use find in this way:</p>
<pre><code class="language-sh">$FOAM_SRC –iname *continuity*
</code></pre>
<p>and open any of the files.</p>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mesh"><a class="header" href="#mesh">Mesh</a></h1>
<p>Mesh in OpenFoam® can be generated using 3 native tools, a combination of
those or translated from other programmes such as ANSYS, STAR-CCM ect with
few native utilities.</p>
<p>The mesh generators are:</p>
<ul>
<li>blockMesh</li>
<li>blockMesh + snappyHexMesh</li>
<li>cfMesh</li>
</ul>
<p>while the principal mesh converter are:</p>
<ul>
<li>fluent3DMeshToFoam</li>
<li>fluentMeshToFoam</li>
</ul>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="blockmesh"><a class="header" href="#blockmesh">blockMesh</a></h1>
<p>First step is to create a dummy folder with the tutorial command:</p>
<pre><code class="language-sh">restore0Dir
</code></pre>
<p>blockMesh is a cartesian mesh generators which relies on a single
dictionary located at <code>system/blockMeshDict</code>. The programme starts
executing in terminal:</p>
<pre><code class="language-sh">blockMesh
</code></pre>
<p>The mesh will be generated inside the folder <code>constant/polyMesh</code>.
Parameters to control this command is in <code>system/blockMeshDict</code> which
defines the domain through vertices, define the blocks and set the
number of elements in the segment.</p>
<blockquote>
<p><strong>Warning:</strong>
Be consistent – side of different blocks must contain the same number on elements and bias.
In blockMesh.boundary, use the rule of the right hand to create the normal to the surface towards the intern of the body.</p>
</blockquote>
<p>An example is posted here from the tutorial <code>/opt/OpenFOAM/OpenFOAM-v2206/tutorials/multiphase/interFoam/RAS/damBreak</code>:</p>
<pre><code class="language-sh">FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    object      blockMeshDict;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

scale   0.146;

vertices
(
    (0 0 0)
    (2 0 0)
    (2.16438 0 0)
    (4 0 0)
    (0 0.32876 0)
    (2 0.32876 0)
    (2.16438 0.32876 0)
    (4 0.32876 0)
    (0 4 0)
    (2 4 0)
    (2.16438 4 0)
    (4 4 0)
    (0 0 0.1)
    (2 0 0.1)
    (2.16438 0 0.1)
    (4 0 0.1)
    (0 0.32876 0.1)
    (2 0.32876 0.1)
    (2.16438 0.32876 0.1)
    (4 0.32876 0.1)
    (0 4 0.1)
    (2 4 0.1)
    (2.16438 4 0.1)
    (4 4 0.1)
);

blocks
(
    hex (0 1 5 4 12 13 17 16) (23 8 1) simpleGrading (1 1 1)
    hex (2 3 7 6 14 15 19 18) (19 8 1) simpleGrading (1 1 1)
    hex (4 5 9 8 16 17 21 20) (23 42 1) simpleGrading (1 1 1)
    hex (5 6 10 9 17 18 22 21) (4 42 1) simpleGrading (1 1 1)
    hex (6 7 11 10 18 19 23 22) (19 42 1) simpleGrading (1 1 1)
);

edges
(
);

boundary
(
    leftWall
    {
        type wall;
        faces
        (
            (0 12 16 4)
            (4 16 20 8)
        );
    }
    rightWall
    {
        type wall;
        faces
        (
            (7 19 15 3)
            (11 23 19 7)
        );
    }
    lowerWall
    {
        type wall;
        faces
        (
            (0 1 13 12)
            (1 5 17 13)
            (5 6 18 17)
            (2 14 18 6)
            (2 3 15 14)
        );
    }
    atmosphere
    {
        type patch;
        faces
        (
            (8 20 21 9)
            (9 21 22 10)
            (10 22 23 11)
        );
    }
);

mergePatchPairs
(
);
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="snappyhexmesh"><a class="header" href="#snappyhexmesh">SnappyHexMesh</a></h1>
<p>In order to define the patches with snappyHexMesh you need to use
different files (in STL format, for compatability reasons, wrting in STL-ASCII
format might be beneficial) that can assemble in a watertight shell geometry. Use the
utility surfaceCheck to proof that your STL is watertight.</p>
<hr />
<p>The files are suppoed to be stored in "constant/triSurface" rigorously
in this format <code>&lt;file&gt;.stl</code> and plus a description on "sytem/surfaceFeatureDict"
substituting and adding the entries and modifying the featured angles
(170°(advised) - 180°: to include all the angles between two neighboured
cells, lowering this value it wouldn’t be consider these cells and it
will be applied a merged cell).</p>
<h2 id="how-to-start-a-case-in-single-and-parallel"><a class="header" href="#how-to-start-a-case-in-single-and-parallel">How to start a case in single and parallel</a></h2>
<p>After the execution of:</p>
<pre><code class="language-sh">surfaceFeatureExtract
</code></pre>
<p>in "constant/triSurface" the same folder should appear <code>&lt;file&gt;.eMesh</code> and a new directory
will be generated as "constant/extendedFeatureEdgeMesh"</p>
<p>If you want to extract very thin layer, use the utility</p>
<pre><code class="language-sh">extrudeMesh
</code></pre>
<p>dependent on the dictionary <code>system/extrudeMeshDict</code> to extrude some layers
externally to the geometry, however, make sure that those created are
very thin.</p>
<p>The following commands will start the meshing process:</p>
<div class="table-wrapper"><table><thead><tr><th>Single process</th><th>Parallel processes</th></tr></thead><tbody>
<tr><td>snappyHexMesh -overwrite</td><td>decomposePar -force</td></tr>
<tr><td></td><td>mpirun -n 16 snappyHexMesh -parallel -overwrite</td></tr>
<tr><td></td><td>reconstructParMesh -latestTime -constant</td></tr>
</tbody></table>
</div>
<h2 id="meshing-multiples-bodies"><a class="header" href="#meshing-multiples-bodies">Meshing multiples bodies</a></h2>
<p>If you want to mesh different entities with separate mesh, you might run twice
snappyHexMesh with different value of Location in mesh and then use the tool <code>mergeMesh</code>.
Otherwise you can use the dictionary before running the mesh.
To permit the recognition of different closed STL files the
sub-dictionary "snappyHexMesh.castellatedMeshControls.locationInMesh" must
be modified in "snappyHexMesh.castellatedMeshControls.locationsInMesh" and
follow a similar resolution:</p>
<pre><code class="language-c++">    …
   locationsInMesh
      (
        ((0.010276 0.058958 0.000248) zone1)
  	    ((0.011472 0.10046  0.000256) zone2)
       );
   …
</code></pre>
<p>In this scenario, it is possible to introduce to bodies as a single mesh
without recurring to use the utility <code>mergeMeshes</code>. The bodies will be
distinguished from a different cellZones allocations.</p>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../../footers/footer_second_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="internal-flow"><a class="header" href="#internal-flow">Internal flow</a></h1>
<p>To fix the boundary conditions, prepare watertight STL files as
inlet.stl, outlet.stl, ect. Then in <code>system/snappyHexMeshDict.geometry</code> define:
section</p>
<pre><code class="language-c++">geometry
{
    inlet.stl
    {
        type triSurfaceMesh;  // It grabs STL files from constant/triSurface
        name inlet;
    }
    outlet.stl
    {
        type triSurfaceMesh;
        name outlet;
    }
    wall.stl
    {
        type triSurfaceMesh;
        name wall;
    }
}

</code></pre>
<p>While in the refinement surfaces section you can address the
info of the patch:</p>
<pre><code class="language-c++">refinementSurfaces
{
    inlet
    {

        level (2 2);
        patchInfo
        {
            type patch;
        }
    }
    outlet
    {

        level (2 2);
        patchInfo
        {
            type patch;
        }
    }
    wall
    {
        level (2 2);
        patchInfo
        {
            type wall;
        }
    }
}
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../../footers/footer_second_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setting-zones-inside-the-mesh-for-source-terms"><a class="header" href="#setting-zones-inside-the-mesh-for-source-terms">Setting zones inside the mesh for source terms</a></h1>
<p>Sets and Zones, can store any mesh entity (point, face or cell) in a
data structure that is somewhat similar to a list. The major difference
is in the internal handling of the mesh entities, especially in the case
of a parallel simulation with topological mesh changes. In this case,
the addressing in the list has to be updated accordingly and only the
zone provides such a method (use cellZone for this purpose).</p>
<ul>
<li>
<p>pointSet/faceSet/cellSet provide a named list of point/face/cell
indexes. Essentially, it's just the result of a selection of
points/faces/cells, so that you can then do something with them,
since you know which ones you want. Usually, these sets are used for
data sampling and for creating faceZones or cellZones</p>
</li>
<li>
<p>cellZone are an extension to the sets, since zones provide
additional information useful for mesh manipulation. Zones are
commonly used for MRF, baffles, dynamic meshes, porous mediums and
other features available through the dictionary system/fvOptions</p>
</li>
</ul>
<p>Sets can be used to create Zones and vice versa. As a reminder first
create a cellSet and then fed the cell set into the creation of the
cellZone to use fvOptions</p>
<p>The selection is usually performed by the tools, both of which can
select subsets of the mesh and perform boolean operations on them</p>
<ul>
<li>
<p>setSet → Use an interactive window</p>
</li>
<li>
<p>topoSet → Use a dictionary in <code>system/topoSetDict</code></p>
</li>
</ul>
<p>Two example of topoSet  are listed below:</p>
<h2 id="the-implementation-of-2-cellzones-from-stl-files"><a class="header" href="#the-implementation-of-2-cellzones-from-stl-files">The implementation of 2 cellZones from STL files:</a></h2>
<pre><code class="language-c++">FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    location    "system";
    object      topoSetDict;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

actions
(
    {
        name    HE_frontCellSet;
        type    cellSet;
        action  new;
        source  searchableSurfaceToCell;//surfaceToCell;
        surfaceType  triSurfaceMesh;
        surfaceName    HE_front.stl; 
    }
    {
       name HE_front;
       type cellZoneSet;
       action new;          // new cellSet, it doesn't simply add to a previous cellSet
       source setToCellZone;//zoneToCell;
       set  HE_frontCellSet;

    }
    {
        name    HE_frontLateralCellSet;
        type    cellSet;
        action  new;
        source  searchableSurfaceToCell;//surfaceToCell;
        surfaceType  triSurfaceMesh;
        surfaceName    HE_frontLateral.stl; 
    }
    {
       name HE_frontLateral;
       type cellZoneSet;
       action new;   // new cellSet, it doesn't simply add to a previous cellSet
       source setToCellZone;//zoneToCell;
       set  HE_frontLateralCellSet;
    }
);
</code></pre>
<h2 id="implementation-of-cellzones-and-facezones"><a class="header" href="#implementation-of-cellzones-and-facezones">Implementation of cellZones and faceZones</a></h2>
<pre><code class="language-c++">FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    location    "system";
    object      topoSetDict;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

actions
()
   // FaceZones
    {
        name      baffleSET;
        type      faceSet;
        action    new;
        source    surfaceToCell;
        file      copper.stl;
    }
    {
        name        baffle;
        type        faceZoneSet;
        action      new;
        source      setToFaceZone;
        faceSet     baffleSET;
    }

   // CellZones
    {
        name           notPCB;
        type           cellSet;
        action         new;
        source         zoneToCell;
        zones          ( water air hydrogen);
    }
    {
        name    solid;
        type    cellSet;
        action  new;
        source  boxToCell;
        box     (-1 -1 -1) (1 1 1);
    }
    {
        name    solid;
        type    cellSet;
        action  subtract;
        source  cellToCell;   // select all the cells from given cellSet(s).
        set     notPCB ;
    }
    {
        name    PCB;
        type    cellZoneSet;
        action  new;
        source  setToCellZone;
        set     solid ;
    }

);

// ************************************************************************* //

</code></pre>
<h3 id="delete-a-zone"><a class="header" href="#delete-a-zone">Delete a zone</a></h3>
<p>To visualize how much Cell Zone there is inside the domain run
checkMesh, while if you desire to delete a cellZone, delete the files
that topoSet creates in: <code>constant/polyMesh/sets</code></p>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../../footers/footer_second_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="multiple-regions"><a class="header" href="#multiple-regions">Multiple regions</a></h1>
<p>We can create regions from <code>snappyHexMesh</code> setting up "system/snappyHexMeshDict" like this:</p>
<pre><code class="language-c++">castellatedMeshControls
{
    maxLocalCells   300000;
    maxGlobalCells  9000000;
    minRefinementCells 40;
    maxLoadUnbalance 0.1;
    nCellsBetweenLevels 2;
    locationsInMesh (
        ((0.144701 0.017648  -0.042372) aluminum)
        ((0.161481 0.009546 -0.0572022) fluid_domain)

        ((0.056485 0.023659 -0.018144) plates)
        ((0.105862 0.023659 -0.018144) plates)
        ((0.172814 0.023659 -0.018144) plates)
        );

    ...
</code></pre>
<p>Following instead the follwoing "system/topoSetDict" we set cellZones around the domain
interacting with what has been implemented previously with <code>snappyHexMesh</code></p>
<pre><code class="language-c++">    ...
    object      topoSetDict;
}

actions
(
    {
        name    epoxy_CellSet;
        type    cellSet;                 //  cellSet is created
        action  new;
        source  searchableSurfaceToCell; //  search from an a surface
        surfaceType  triSurfaceMesh;     //  which is defined by an stl file
        surfaceName  epoxy.stl;
    }
    {
       name epoxy;
       type cellZoneSet;
       action new;            // cellZone is created 
       source setToCellZone;  // refer to the cellSet above 
       set  epoxy_CellSet;
    }
    {
        name    copper_CellSet;
        type    cellSet;
        action  new;
        source  searchableSurfaceToCell;
        surfaceType  triSurfaceMesh;
        surfaceName  copper_heat_exchanger.stl;
    }
    {
       name copper;
       type cellZoneSet;
       action new;           
       source setToCellZone; 
       set copper_CellSet;
    }
    {
       name aluminum;
       type cellZoneSet;
       action subtract;
       source zoneToCell; 
       zones  (
        copper
        epoxy
        plates
        fluid_domain
       );
    }
)
</code></pre>
<p>if you run <code>checkMesh</code> you will notice the generation of multiple cellsZones such as:</p>
<pre><code class="language-c++">Checking basic cellZone addressing...
                CellZone        Cells       Points       VolumeBoundingBox
               aluminum       569510       835668  0.000254241 (-3.020417e-06 0 -0.07205508) (0.2200032 0.02058048 8.201096e-06)
           fluid_domain      2113560      2629640 5.075231e-05 (-1.233849e-05 0.004437673 -0.062375) (0.2200123 0.02002402 -0.006539311)
                 plates       896580      1084860  1.09089e-05 (0.0145 0.02299985 -0.0655) (0.2055 0.02415002 -0.003498615)
                  epoxy       731605       946011 4.763413e-05 (0.00998581 0.02282949 -0.0670095) (0.2100142 0.0280409 -0.00191977)
                 copper      1516780      2095400 4.684542e-05 (0.009995011 0.01575065 -0.06700418) (0.210005 0.02305153 -0.001525676)
</code></pre>
<p>From there you can split the mesh for executing a multi region solver. For example a Conjugated Heat Transfer.</p>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../../footers/footer_second_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html><div style="break-before: page; page-break-before: always;"></div><h1 id="advanced-refinement-technique"><a class="header" href="#advanced-refinement-technique">Advanced refinement technique</a></h1>
<p>The necessity to refine area that sometimes require a complex shape can
be satisfied through the usage of an STL file as a cellZone entry.
First, define a closed STL file through "snappyHexMeshDict.geometry" then
use this frame in the respective <code>snappyHexMeshDict</code> sector:</p>
<pre><code class="language-c++">    ...

    refinementSurfaces
    {
        &lt;closedSTLFileYouWantToRefine&gt;
        {
            level (1 2);

            cellZone        &lt;nameCellZone&gt;;
            faceZone        &lt;nameFaceZone&gt;;
            cellZoneInside  inside;
        }
      
    …

    refinementRegions
    {
        &lt;closeSTLFileYouWantToRefine&gt;
        {
            mode   &lt;mode&gt;;            // can be "distance" , "inside" or "outside"
            levels ((0.000008 3));
        }
    }
    ...
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../../footers/footer_second_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cfmesh"><a class="header" href="#cfmesh">cfMesh</a></h1>
<p>CfMesh is a mesher which is integrate in OpenFOAM® such as
SnappyHexMesh and it is possible to find the tutorial relatives to it
in:</p>
<pre><code class="language-sh">/opt/OpenFOAM/OpenFOAM-v2206/modules/cfmesh/tutorials
</code></pre>
<p>The modalities to create a mesh pass always through the creation of a .stl
bodies as boundaries, i.e. create all different .stl file as surface
(ASCII and divided per patch that you intend to apply a boundary
condition)</p>
<pre><code class="language-sh">cat body_1.stl body_2.stl body_N.stl &gt;&gt; combined.stl
</code></pre>
<p>To permit at the program to select different patches of the geometry,
remember to check inside the combined file and ensure there is a space
between the joint of the different STL files. To create the .fms file
needed to run the cfMesh utilities (specific for OpenFoam®) run the
following commands.</p>
<pre><code class="language-sh">surfaceFeatureEdges –angle 15 combined.stl combined.fms
</code></pre>
<p>The flag <code>angle</code> permit to capture correctly sharp corner of
the geometry, the lower is set the more it will be precise and
computationally expensive, I found 15 being a good compromise, the
default is 45. Secondly, to set the boundary condition in the easiest
way, open the .fms file (the OpenFOAM® format) to change the type of
boundaries (wall, patch, empty) in the first rows. Then the following
modifications acts on the dictionary system/meshDict. Then to run the
cited dictionary type the command:</p>
<pre><code class="language-sh">cartesianMesh
</code></pre>
<p>For command to run require that the directory <code>system/meshDict</code> contain
only the voice:</p>
<pre><code class="language-c++">surfaceFile "…";

maxCellSize "…";
</code></pre>
<p>If you are not satisfied with the result, try to run these utilities to
improve the results:</p>
<pre><code class="language-sh">improveMeshQuality
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="checkmesh"><a class="header" href="#checkmesh">checkMesh</a></h1>
<p>checkMesh will check for:</p>
<ul>
<li>Mesh statistics</li>
<li>Topology</li>
<li>Geometry and mesh quality (bounding box, cell volumes,
skewness, orthogonality, aspect ratio, and so on).</li>
</ul>
<p>To check the most important parameters of the mesh, run the utilities without flags:</p>
<pre><code class="language-sh">checkMesh
</code></pre>
<p>If checkMesh explicitly generates an error, this error field must be repaired. To check all
the possible measurable parameters of the mesh (often an overkill utilities), and visualise all the fields, run:</p>
<pre><code class="language-sh">checkMesh -allGeometry -allTopology -writeAllFields -writeSets vtk
</code></pre>
<p>Most of the time, it is impossible to get no errors when we look at all the mesh fields.
A more progmatic way, is to write the field when you encouter an important error,
so you can post-process via ParaView your mesh and check all the defective set of cells, faces
and/or points written to the <code>constant/polyMesh/sets/</code> directory with the following flags</p>
<pre><code class="language-sh">checkMesh -writeSets vtk
</code></pre>
<p>It will write Sets and cellZones.</p>
<h2 id="most-important-mesh-parameters"><a class="header" href="#most-important-mesh-parameters">Most important mesh parameters</a></h2>
<p>Only few parameters between <code>Settings</code> and <code>Topology</code> must kept under control to
produce a sufficient output.</p>
<h3 id="settings"><a class="header" href="#settings">Settings</a></h3>
<p>The most important parameters to keep under control when we deal with mesh genration are:</p>
<div class="table-wrapper"><table><thead><tr><th></th><th>Non orthogonality</th><th>Skewness</th></tr></thead><tbody>
<tr><td><b>Rapresentation</b></td><td><img src="mesh/non-orthogonal-mesh.png" alt="img" /></td><td><img src="mesh/non-orthogonal-skewed-mesh.png" alt="img" /></td></tr>
<tr><td><b>Limits</b></td><td>Not run a case if it is above 80</td><td>Acceptable under 3</td></tr>
</tbody></table>
</div>
<p>Then is very important to check minVolume (if it is negative, check the .stl files or setting)</p>
<h3 id="topology"><a class="header" href="#topology">Topology</a></h3>
<p>To improve the quality of the mesh try to remove as much as
possible tetrahedra and tet wedges.</p>
<h2 id="deletion-of-bad-quality-cells"><a class="header" href="#deletion-of-bad-quality-cells">Deletion of bad quality cells</a></h2>
<p>You can delete bad cells if they are not in region of interest, if this
is the case, utilities such as <code>setSet</code> and <code>subsetMesh</code> can be
useful tools, otherwise it is strongly advised to re-mesh. Instead, deleting mesh
arbitrarely is usually done via this utilities.</p>
<pre><code class="language-sh">setSet -constant
</code></pre>
<p>An internal command line will appear, and similar command can be used to
manage bad cells present in your mesh (i.e. concave, underdetermined,
zero volume cells), in the followng commands a zero-volume cells are treated:</p>
<pre><code class="language-sh"># if you want to fix additional cells and with problematic faces you can (i.e. skew, concave, warp faces etc..)
cellSet c0 new cellToCell zeroVolumeCells any
cellSet c0 add faceToCell skewFaces any
cellSet c0 invert &amp;&amp; quit
</code></pre>
<p>Once exited from the internal command line, execute the following
command to overwrite the mesh</p>
<pre><code class="language-sh">subSetMesh c0 -overwrite
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ansys-meshing-to-openfoam"><a class="header" href="#ansys-meshing-to-openfoam">ANSYS Meshing to OpenFoam®</a></h1>
<p>OpenFoam® needs to read a mesh via file written in ASCII format, if it comes from another
program. As a consequence to export a Fluent .msh file in ASCII format the shortest way
(from ANSYS meshing) is:</p>
<p>File → Option → Meshing → Export → Format of input file (.msh)</p>
<p>Choose ASCII and then you can easily extract the file in ASCII format by
exporting the mesh. Then move the produced file on the root directory of your case
and run:</p>
<pre><code class="language-sh">fluentMeshToFoam foo.msh
</code></pre>
<p>Remember that it is good practice check the boundary setting in
<code>constant/polyMesh/boundary</code> after a conversion</p>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="directories-structure"><a class="header" href="#directories-structure">Directories’ structure</a></h1>
<p>The following directories tree is a representation of a file arrangement
for setting up an OpenFoam® case:</p>
<pre><code class="language-sh">.
├── 0.orig                          →  Initial value settings
│   ├── k                                   →  Turbulent kinetic energy
│   ├── nut                                 →  Turbutent kinematic viscosity
│   ├── omega                               →  Specific rate of turbulent dissipation
│   ├── p                                   →  Pressure
│   └── U                                   →  Velocity
├── Allclean
├── Allrun
├── constant                        →  Initial value settings
│   ├── transportProperties                 →  Fluid properties
│   └── turbulenceProperties                →  Turbulence model selection
└── system                          →  Settings
    ├── blockMeshDict                       → Dictionary for cartesian mesh generation
    ├── controlDict                         → Running time and I/O control
    ├── decomposeParDict                    → Dictionary to control the parallelization scheme
    ├── fvSchemes                           → Terms, scheme, numerical settings
    ├── fvSolution                          → Tolerance, algorithm and solver settings
    ├── snappyHexMeshDict                   → Dictionary for mesh generation (with snappyHexMesh)
    └── surfaceFeatureExtractDict           → Dictionary de facto needed for mesh generation (with snappyHexMesh)
</code></pre>
<p>You can change the problem settings on-the-fly during the calculation, on the dictionaries:</p>
<pre><code class="language-sh">- controlDict
- fvSchemes
- fvSolution
</code></pre>
<p>As long as in <code>system/controlDict</code> the option is set as:</p>
<pre><code class="language-c">runTimeModifiable     yes
</code></pre>
<p>before the calculation is instanciated.</p>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="0-ie-boundary-conditions"><a class="header" href="#0-ie-boundary-conditions">0 (i.e. Boundary Conditions)</a></h1>
<p>The BC works on the Patches which have been defined in the mesh and the
guessing of the first value of the field pass through the voice</p>
<pre><code class="language-c++">internal field
</code></pre>
<p>which can be filled with a uniform, but it could be changed in
non-uniform if set values in system/setFieldsDict and then apply this
change through setFields</p>
<h2 id="commmon-types-of-boundary-conditions"><a class="header" href="#commmon-types-of-boundary-conditions">Commmon types of boundary conditions:</a></h2>
<p>The most common types of patches are:</p>
<h3 id="fixedvalue"><a class="header" href="#fixedvalue">fixedValue</a></h3>
<p>Every face associated to the boundary is set to the conditions</p>
<h3 id="zerogradient"><a class="header" href="#zerogradient">zeroGradient</a></h3>
<p>Matematically speaking it is a symmetry conditon hence it implements at the boundaries:
\[ ∂ϕ ∕ ∂x = 0 \]</p>
<p>Where "x" is the space and ϕ is a field properties.</p>
<h3 id="symmetryplane"><a class="header" href="#symmetryplane">symmetryPlane</a></h3>
<p>Applied to planar patches to represent a symmetry condition, equivalent to <code>zeroGradient</code>.</p>
<pre><code class="language-c++">symmetryPatch
{
    type            symmetryPlane;
    ...
}
</code></pre>
<h3 id="noslip"><a class="header" href="#noslip">noSlip</a></h3>
<p>It is a velocity condtion and it is equivalent to:</p>
<pre><code>wallPatch
{
    type            fixedValue;
    value           0;
}
</code></pre>
<h3 id="empty"><a class="header" href="#empty">empty</a></h3>
<p>To set a 2D simulation</p>
<pre><code class="language-c+++">frontAndBack
{
    type        empty;
}
</code></pre>
<h3 id="amicyclic"><a class="header" href="#amicyclic">AMIcyclic</a></h3>
<p>Impose a periodic BC when the patches in study have not the
same mesh, it must be declared the nature of periodicity (rotational,
translation). The separationVector must contain the distances between
the 2 patches in study. It is advised to use a createPatchDict to modify
the BC after snappy procedure of snappyHexMesh because can cause
problems to the patches)</p>
<h3 id="calculated"><a class="header" href="#calculated">calculated</a></h3>
<p>Calculate the value from its component in the field, this
doesn’t work for transport quantities but only for variable define by a
formulae (for instance nut)</p>
<h3 id="totalpressure"><a class="header" href="#totalpressure">totalPressure</a></h3>
<p>which is a fixedValue condition calculated from p and U
field</p>
<h3 id="pressureinletoutletvelocity"><a class="header" href="#pressureinletoutletvelocity">pressureInletOutletVelocity</a></h3>
<p>Which applies a zeroGradient on all
components, except where there is inflow, in this case a fixedValue
condition is applied to the tangential component</p>
<h3 id="inletoutlet"><a class="header" href="#inletoutlet">inletOutlet</a></h3>
<p>It is a zeroGradient condition when outwards, fixedValue
when flow is inwards</p>
<pre><code class="language-c">  {
    type inletOutlet;
    inletValue uniform (0 0 0); // value of the velocity
    value uniform x;            // value of the properties
  }
</code></pre>
<p>Basically, inletOutlet is zero gradient unless the flow is inward in
which case it is fixed value (inletValue). outletInlet is zero gradient
if the flow is inward and fixed value (outletValue) if the flow is
outward.</p>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../../footers/footer_second_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ε-ω-k"><a class="header" href="#ε-ω-k">ε, ω, k</a></h1>
<p>An estimation of the turbulent mainstream quantities should take place
to have a stable solver.</p>
<h2 id="turbulent-external-flow-approximations"><a class="header" href="#turbulent-external-flow-approximations">Turbulent external flow approximations</a></h2>
<p>External flows can be a bit tricky to approximate because it is hard to
evaluate the flow downstream considering anything that could have
affected the turbulence. This could be other objects, convection over
land or the position of the domain in a boundary layer. A good technique
for approximation turbulence is by using the Turbulent Viscosity
Ratio—the ratio between molecular viscosity and turbulent viscosity.
This ratio can be used along with the Turbulence Intensity, freestream
velocity and molecular viscosity to determine k, ε and ω using the
following technique. To start the calculation, the Turbulent Intensity
I, and Viscosity Ratio β need to be approximated by using the table
below.</p>
<div class="table-wrapper"><table><thead><tr><th>Turbulence</th><th>Reynolds number</th><th>Turbulent Intensity</th></tr></thead><tbody>
<tr><td>Low turbulence</td><td>3000 &lt; Re &lt; 5000</td><td>1%</td></tr>
<tr><td>Med turbulence</td><td>5000 &lt; Re &lt; 15000</td><td>1-5%</td></tr>
<tr><td>High turbulence</td><td>15000 &lt; Re &lt; 20000</td><td>5-20%</td></tr>
<tr><td>High turbulence</td><td>Re &gt; 100000</td><td>5-20%</td></tr>
</tbody></table>
</div>
<p>To calculate k, the following equation can be used:</p>
<p>\[ k = \frac{3}{2}\left( \text{UI} \right)^{2} \]</p>
<p>\[ ε = C_{\mu}\frac{\text{ρk}^{2}}{\mu}β ^{- 1}\ \]</p>
<p>\[ ω = \frac{ρk}{\mu}\ β^{-1}\ \]</p>
<h2 id="turbulent-internal-flow-approximations"><a class="header" href="#turbulent-internal-flow-approximations">Turbulent internal flow approximations</a></h2>
<p>For a fully developed inlet flow, approximating turbulent boundary
conditions can be extrapolated using the Reynolds number <em>Re</em> to
determine the turbulent intensity <em>I</em> to define the intensity length
scale <em>l</em>, the required turbulent boundary conditions can be calculated.</p>
<p>\[ I = 0.16 \ Re_L ^{-1/8} \]</p>
<p>This can be used to calculate a mean approximation for the turbulent
boundary conditions</p>
<p>\[ k = \frac{3}{2} U I^{2} \]</p>
<p>\[ ε = C_{\mu}\frac{k^{\frac{3}{2}}}{l} = C_{\mu}\frac{k^{\frac{3}{2}}}{0.07L} \]</p>
<p>\[ ω = \frac{\varepsilon}{kC_{\mu}}\  \]</p>
<h2 id="turbulent-wall-functions"><a class="header" href="#turbulent-wall-functions">Turbulent Wall functions</a></h2>
<p>Keeping the focus only in the treatment of the wall, the corresponding
wall functions exist:</p>
<ul>
<li>εWallFuncion for ε( (fixed value e=0 or better e=1e-8(?) for lowRe
calculations):</li>
</ul>
<p>calculate (for each timestep) the first grid point value by using an
algebraic expression derived from the classical logarithmic law-of the
wall approach</p>
<ul>
<li>kqRWallFunction for k, q, R</li>
</ul>
<p>in code: Boundary condition for turbulence k, Q, and R when using wall
functions. Simply acts as a zero-gradient condition. It appears to be
applicable down to yPlus ~ 1, but one should use a fixed value with k=0
or a very small value for y<sup>+</sup> &lt;1)</p>
<p>\ omegaWallFunction for omega; Not really a wall function but the b.c.
defined by Menter for Omega, i.e. should be used always for kOmega
model, independent of y<sup>+</sup>)</p>
<p>omegawall=60*nu/(β *y+<sup>2</sup>), with nu=kinematic viscosity at the wall,
β =0.075 and y<sup>+</sup>normal distance between the first fluid node and the
nearest wall-&gt; very large value for omega)</p>
<p>The "value" which is specified for the wall functions is only an initial
condition</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nut----ν_t-"><a class="header" href="#nut----ν_t-">nut - \( ν_{t} \)</a></h1>
<p>The entries for \( ν_{t} \) are type calculated because they come from ε and k
to calculate the field. Instead in the wall, you specify a wall function
for \( ν_{t} \), to modify the momentum equation for the cells adjacent to the
wall. The modification is that OpenFoam® calculates wall shear stress
from log-law for these cells and put it in their equations. OpenFoam®
does not use log-law directly to obtain next-to-the-wall cell velocities
but solves their equation in which the stress term is modified using
log-law.</p>
<h2 id="turbulent-viscosity-wall-functions"><a class="header" href="#turbulent-viscosity-wall-functions">Turbulent viscosity wall functions</a></h2>
<p>The choice of wall function model is specified through the turbulent
viscosity field  \( ν_{t} \) in the 0/nut dictionary by the nutxxxxxx
wall functions:</p>
<ul>
<li>
<p>nutWallFunction seems to be the most basic wall function without
further requirements: high-Re wall-function based on k.</p>
</li>
<li>
<p>nutkWallFunction standard for k-ε/k-ω, it calculates the turbulent
viscosity in the first node point based on the logarithmic law based
on the k value close to the wall</p>
</li>
<li>
<p>nutUWallFunction: in comparison to nutkWallFunction it calculates the y<sup>+</sup>sup&gt;+</sup> yPlus value based on the velocity close to the
wall</p>
</li>
<li>
<p>nutUSpaldingWallFunction standard wall function for the Spallart
Allmarras turbulence model, called nutSpalartAllmarasWallFunction, continuous wall-function which should cover the complete y<sup>+</sup> range from O(1) to somewhere of O(10). Might be the best choice (together with low Re k-ε, k-ω, or SA, when y<sup>+</sup> varies for different parts of the wall.</p>
</li>
<li>
<p>nutLowReWallFunction (code comment: "Sets \( ν_{t} \) to zero and provides an access function to calculate y<sup>+</sup>."):</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="constant"><a class="header" href="#constant">Constant</a></h1>
<p>The "constant" directory represent all the constant parameters of the CFD case such
as mesh, immutable fluid properties, physical model.</p>
<pre><code class="language-sh">    ├── polyMesh
    │   ├──...
    │   └──...
    ├── transportProperties
    ├── ...
    └── turbulentProperties
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../../footers/footer_second_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="transportproperties"><a class="header" href="#transportproperties">transportProperties</a></h1>
<p>nu is the kinematic viscositym, follows the value of the air at given temperature:</p>
<p>\begin{equation}
\nu_{\text{air}} = \frac{\mu}{\rho} = 1.48 \times 10^{- 5}\ \frac{m^{2}}{s}<br />
\end{equation}</p>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../../footers/footer_second_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="turbulentproperties"><a class="header" href="#turbulentproperties">turbulentProperties</a></h1>
<p>The current dictionary act as the selector for the turbulence model.
Consequent quanitie must be updated or introduced given the model you of turbulence you want to solve.</p>
<h2 id="rans-model-reynolds-average-navier-stokes"><a class="header" href="#rans-model-reynolds-average-navier-stokes">RANS model (Reynolds Average Navier Stokes)</a></h2>
<p>Usually three models are used and they can be specified in this way on <code>constant/turbulenceProperties</code>:</p>
<pre><code class="language-c++">simulationType      RAS;

RAS
{
    RASModel        kOmegaSST;  // or kEpsilon, kOmega, etc

    turbulence      on;

    printCoeffs     on;
}
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../../footers/footer_second_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="polymesh"><a class="header" href="#polymesh">polyMesh</a></h1>
<p>Contains all the mesh details as:</p>
<h2 id="sets"><a class="header" href="#sets">Sets</a></h2>
<p>A set is an ordered part of the mesh (often a portion of the domain), usually produced by the
utilities: <code>checkMesh</code>,<code>topoSet</code> or <code>setSet</code></p>
<p>Diversifying the output between:</p>
<ul>
<li>pointZone</li>
<li>faceZone</li>
<li>cellZone</li>
</ul>
<h2 id="boundary"><a class="header" href="#boundary">Boundary</a></h2>
<p>Each patch can be put inGroups for pre and post-processing purpose. Each
patch can thus be in several groups. The patchGroup generated by this
makes e.g. setting of boundary conditions easier. A patch boundary
condition definition takes precedence over a patchGroup boundary
condition.</p>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../../footers/footer_second_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="thermophysical-model"><a class="header" href="#thermophysical-model">Thermophysical model</a></h1>
<p>The thermophysicalProperties dictionary is read by any solver that uses
the thermophysical model library.</p>
<p>Types of thermo class</p>
<ul>
<li>hePsiThermo: General thermophysical model calculation based on compressibility ψ = 1/(RT) - Only gas</li>
<li>heRhoThermo: General thermophysical model calculation based on density ρ. Gas, liquid, solids</li>
<li>heSolidThermo: Only solids</li>
<li></li>
</ul>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../../footers/footer_second_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="system"><a class="header" href="#system">System</a></h1>
<p>The system directory contains all the setting relative to the case.</p>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../../footers/footer_second_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="controldict"><a class="header" href="#controldict">controlDict</a></h1>
<p>The time from where simulation starts (startFrom), the time when the
simulation finishes (stopAt), the time step (deltaT), the data saving
interval (writeInterval), the saved data file format (writeFormat), the
saved file data precision (writePrecision), and if changing the files
during the run can affect the run or not (runTimeModifiable) are set in
this file.</p>
<p><em>Note</em>: If the write format is ASCII, then the simulation data which is
written to the file can be opened and read using any text editor. If the
format is binary, the data will be written in binary style and is not
readable by text editors. The advantage of binary over ASCII is the
smaller file size, and consequently faster conversion and writing to
disk, for big simulations.</p>
<p>A simple example of a <code>controlDict</code> is display below:</p>
<pre><code class="language-c++">FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    location    "system";
    object      controlDict;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

application     simpleFoam;

startFrom       latestTime;

startTime       0;

stopAt          endTime;

endTime         1000;

deltaT          1;

writeControl    timeStep;

writeInterval   100;

purgeWrite      0;

writeFormat     binary;

writePrecision  6;

writeCompression off;

timeFormat      general;

timePrecision   6;

graphFormat     raw;  // (raw is default)

runTimeModifiable true;

functions
{
    #include "yPlus"
}
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../../footers/footer_second_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fvschemes"><a class="header" href="#fvschemes">fvSchemes</a></h1>
<p>Contains the instructions to discretize the problem’s
equations. This settings can be changed on run time, however it is required
to set the field <code>controlDict.runTimeModifiable</code> equal to  ``yes``` in the "system/controlDict". In fact, different discretization procedures suit different mesh
refinement/quality and state of simulation.</p>
<div class="table-wrapper"><table><thead><tr><th>Main document keywords</th><th>Category of mathematical terms</th></tr></thead><tbody>
<tr><td>ddtScheme</td><td>First and second time derivatives - ∂∕∂t , ∂<sup>2</sup>∕∂t<sup>2</sup></td></tr>
<tr><td>gradSchemes</td><td>Gradient - ∇</td></tr>
<tr><td>divSchemes</td><td>Divergence - ∇ ∙</td></tr>
<tr><td>laplacianSchemes</td><td>Laplacian - ∇<sup>2</td></tr>
<tr><td>interpolationSchemes</td><td>Point-to-point interpolations of values</td></tr>
<tr><td>snGradSchemes</td><td>Component of gradient normal to a cell face</td></tr>
</tbody></table>
</div>
<p>This schemas defines how you case must be compueted.</p>
<h2 id="gradscheme"><a class="header" href="#gradscheme">gradScheme</a></h2>
<p>This dictionary field tackles the gradient computation in 3 aspects, how to define the compute (scheme),
its interpolation and its limitation, with this arrangement:</p>
<pre><code class="language-c++">gradSchemes
{
    default         none;
    grad(p)         &lt;optional limiter&gt; &lt;gradient scheme&gt; &lt;interpolation scheme&gt;;
}
</code></pre>
<p>The gradients can be computed using two schemes.The keywords are:</p>
<ul>
<li><code>Gauss</code></li>
<li><code>leastSquares</code></li>
</ul>
<p>The leastSquares method is more accurate, however, it tends to be more oscillatory on tetrahedral meshes.
The interpolation can be executed with the following methods:</p>
<ul>
<li><code>linear</code>: cell-based linear</li>
<li><code>pointLinear</code> point-based linear</li>
<li><code>leastSquares</code>: Least squares</li>
</ul>
<p>On the other side, gradient limiters will avoid over and under shoots on the gradient computations. They
increase the stability of the method but add diffusion due to clipping. There are four available:</p>
<ul>
<li><code>cellMDLimited</code></li>
<li><code>cellLimited</code></li>
<li><code>faceMDLimited</code></li>
<li><code>faceLimited</code></li>
</ul>
<p>They are in descendent order of accuracy. <code>faceLimited</code> is the more diffusive one, however it provides stability.
The gradient limiter implementation uses a blending factor</p>
<pre><code class="language-c++">gradSchemes
{
    //         &lt;limiter&gt;     &lt;gradient scheme&gt; &lt;interpolation scheme&gt;
    default    cellMDLimited       Gauss            linear 1            // the blending factor is 1
}
</code></pre>
<p>where 0 means no blending hence the solution will be accurate but less stable. Of course 1 will introduce the maximum blending possible.</p>
<h2 id="divschemes"><a class="header" href="#divschemes">divSchemes</a></h2>
<p>Relates to the evaluation of divergence across cell faces which usually
transport a property Θ under the influence of velocity field φ (phi).
The schemes are all based on Gauss integration, using the flux φ and
the advected field being interpolated to the cell faces by one of the
selected schemes.</p>
<p>These are the convective discretization schemes that you will use most
of the times:</p>
<ul>
<li>
<p><code>Gauss upwind</code> → first order accurate.</p>
</li>
<li>
<p><code>Gauss linearUpwind grad(&lt;Θ&gt;)</code> → second order accurate, bounded.</p>
</li>
<li>
<p><code>Gauss limitedLinear</code> → TVD scheme, second order accurate, bounded. Recommended for LES simulations.</p>
</li>
<li>
<p><code>Gauss linear</code> → linear interpolation, unbounded.</p>
</li>
</ul>
<p>Gauss indicates that derivatives are evaluated via the Gauss’ theorem. While <code>upwind</code> indicates a
standard 1st order upwind interpolation (bounded). First order methods are bounded and stable but diffusive.
Second order methods are accurate, but they might become oscillatory, the most common method to use is
``linearUpwind```, which stands for standard 2nd order interpolation (unbounded). TVD methods such as superBee,
minmod and vanLeer are second order accurate (bounded). TVD methods switch locally to upwind when they detect strong gradients. For the discretization of the diffusive terms instead, you can use a fully orthogonal scheme:</p>
<ul>
<li>linear corrected</li>
<li>linear limited <from0To1></li>
</ul>
<p>0 for bad mesh and 1 for good quality mesh. An accurate and stable numerical scheme (second order accurate) would look like:</p>
<pre><code class="language-c++">divSchemes
{
    div(phi,U)                      Gauss linearUpwind grad(U);
    div(phi,omega)                  Gauss linearUpwind grad(omega);
    div(phi,k)                      Gauss linearUpwind grad(omega);
    div((nuEff*dev2(T(grad(U)))))   Gauss linear;
}
</code></pre>
<h2 id="laplacianschemes"><a class="header" href="#laplacianschemes">laplacianSchemes</a></h2>
<p>For the discretization of the diffusive terms, you can use a fully orthogonal scheme</p>
<pre><code class="language-c++">laplacianSchemes
{
    default  Gauss linear  corrected;
}
</code></pre>
<p>You can also use a scheme that uses a blending between a fully orthogonal scheme
and a non-orthogonal scheme:</p>
<pre><code class="language-c++">laplacianSchemes
{
    default  Gauss linear limited 1
}
</code></pre>
<p>In summary, by setting the blending factor equal to 0 is equivalent to using the uncorrected method. You give
up accuracy but gain stability. If you set the blending factor to 0.5, you get the best of both worlds. In this
case, the non-orthogonal contribution does not exceed the orthogonal part. You give up accuracy but gain stability.
For meshes with non-orthogonality less than 70, set the blending factor to 1. For meshes with non-orthogonality
between 70 and 85, set the blending factor to 0.5. For meshes with non-orthogonality more than 85, it is better
to get a better mesh. But if you definitely want to use that mesh, set the blending factor to 0.333, and increase
the number of non-orthogonal corrections.</p>
<h1 id="discretization-schemes-example"><a class="header" href="#discretization-schemes-example">Discretization schemes example</a></h1>
<p>Few examples are proposed here for different quality thresholds.</p>
<h3 id="non-orthogonality-between-70-and-85"><a class="header" href="#non-orthogonality-between-70-and-85">Non-orthogonality between 70 and 85</a></h3>
<pre><code class="language-c++">gradSchemes
{
    default     cellLimited Gauss linear 0.5;
    grad(U)     cellLimited Gauss linear 1.0;
}
divSchemes
{
    div(phi,U)                      Gauss linearUpwind grad(U);
    div(phi,omega)                  Gauss linearUpwind default;
    div(phi,k)                      Gauss linearUpwind default;
    div((nuEff*dev(T(grad(U)))))    Gauss linear;
}

laplacianSchemes
{
    default Gauss linear limited 0.5;
}
snGradSchemes
{
    default limited 0.5;
}

</code></pre>
<h3 id="non-orthogonality-between-60-and-70"><a class="header" href="#non-orthogonality-between-60-and-70">Non-orthogonality between 60 and 70</a></h3>
<pre><code class="language-c++">gradSchemes
{
    default cellMDLimited Gauss linear 0.5;
    grad(U) cellMDLimited Gauss linear 0.5;
}

divSchemes
{
    div(phi,U) Gauss linearUpwind grad(U);
    div(phi,omega) Gauss linearUpwind default;
    div(phi,k) Gauss linearUpwind default;
    div((nuEff*dev(T(grad(U))))) Gauss linear;
}

laplacianSchemes
{
    default Gauss linear limited 0.777;
}

snGradSchemes
{
    default limited 0.777;
}
</code></pre>
<h3 id="non-orthogonality-between-40-and-60"><a class="header" href="#non-orthogonality-between-40-and-60">Non-orthogonality between 40 and 60</a></h3>
<pre><code class="language-c++">gradSchemes
{
    default cellMDLimited Gauss linear 0;
    grad(U) cellMDLimited Gauss linear 0.333;
}

divSchemes
{
    div(phi,U) Gauss linearUpwind grad(U);
    div(phi,omega) Gauss linearUpwind default;
    div(phi,k) Gauss linearUpwind default;
    div((nuEff*dev(T(grad(U))))) Gauss linear;
}

laplacianSchemes
{
    default Gauss linear limited 1.0;
}

snGradSchemes
{
    default limited 1.0;
}
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../../footers/footer_second_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fvsolution"><a class="header" href="#fvsolution">fvSolution</a></h1>
<p>The dictionary is divided in 3 parts:</p>
<ul>
<li>linear-solver</li>
<li>solver</li>
<li>under-relaxation factor</li>
</ul>
<h2 id="linear-solver-control"><a class="header" href="#linear-solver-control">Linear solver control</a></h2>
<p>Linear solvers are a sets of algorithms to solve the following linear problems in matrix form:</p>
<p>\begin{equation}
\tag{1}
Ax=b
\end{equation}</p>
<p>The solver is said to have found a solution if any one of the following conditions are reached:</p>
<ul>
<li>
<p><code>tolerance</code> Define the exit criterion for the solver, it is the
absolute difference between 2 consecutive iterations and must be low
in steady state while coarser in transient simulation</p>
</li>
<li>
<p><code>relTol</code> Define the exit criterion for the solver, on a relative
difference of solution from 2 consecutive iteration (i.e. 0.1 is
10%)</p>
</li>
<li>
<p><code>maxIter</code> A maximum number of iterations at which the solver is
stopped anyway 1000 as default</p>
</li>
</ul>
<blockquote>
<blockquote>
<p>The solvers controls can be modified on the fly (when a simulation is running).</p>
</blockquote>
</blockquote>
<h3 id="diagonal-solver"><a class="header" href="#diagonal-solver">Diagonal solver</a></h3>
<p>If the matix coefficients have non-zeros values on its diagonal, therefore a set of explicit equations. The solution vector can be
obtained inverting the stiffness matrix without incurring in relevant computational effort:</p>
<ul>
<li><code>diagonal</code>: a diagonal solver for explicit systems.</li>
</ul>
<p>where:</p>
<p>\begin{equation}
\tag{2}
x = A^{-1}b
\end{equation}</p>
<p>Where the inverse of the diagonal matrix is simply:</p>
<p>\begin{equation}
\tag{2}
A^{-1}= \frac{1}{diagonal(A)}
\end{equation}</p>
<h3 id="direct-solvers"><a class="header" href="#direct-solvers">Direct solvers</a></h3>
<p>The following algoritms are direct methods, or method based on Gaussian elimination:</p>
<ul>
<li><code>smoothSolver</code>: Solver that uses a smoother.</li>
</ul>
<p>The solvers that use a smoother require the choice of smoother to be specified as follow</p>
<ul>
<li><code>GaussSeidel</code> Gauss-Seidel.</li>
<li><code>symGaussSeidel</code> symmetric Gauss-Seidel.</li>
<li><code>DIC/DILU</code> incomplete-Cholesky (symmetric), incomplete-LU (asymmetric).</li>
<li><code>DICGaussSeidel</code> diagonal incomplete-Cholesky/LU with Gauss-Seidel (symmetric/asymmetric).</li>
</ul>
<p>When using the smooth solvers, the user can optionally specify the number of sweeps, by the <code>nSweeps</code>
keyword, before the residual is recalculated. Without setting it, it reverts to a default value of 1.</p>
<p>The usage is reported below:</p>
<pre><code class="language-sh">solver          smooth;
smoother        &lt;smoother&gt;;
relTol          &lt;relative tolerance&gt;;
tolerance       &lt;absolute tolerance&gt;;
</code></pre>
<h3 id="iterative-solver-minimization-algorithms"><a class="header" href="#iterative-solver-minimization-algorithms">Iterative solver (Minimization algorithms)</a></h3>
<p>They are solver that start from a guess and they iteratively correct up to the respect
of the equations of the system:</p>
<ul>
<li><code>PCG</code>/<code>PBiCG</code>: Preconditioned (bi-)Conjugate Gradient, with PCG for symmetric matrices, PBiCG for asymmetric matrices.</li>
<li><code>PBiCGStab</code>: Stabilised preconditioned (bi-)conjugate gradient, for both symmetric and asymmetric matrices.</li>
<li><code>GAMG</code>: Generalised Geometric-Algebraic Multi-Grid.</li>
</ul>
<p>The <code>GAMG</code> solver can often be the optimal choice for solving the pressure equation.</p>
<blockquote>
<p>Preconditioners are useful in iterative methods to solve a linear system since the rate of convergence for most iterative
linear solvers increases because the condition number of a matrix decreases as a result of preconditioning. Preconditioned
iterative solvers typically outperform direct solvers, e.g., Gaussian elimination, for large, especially for sparse, matrices.</p>
</blockquote>
<h3 id="preconditioners"><a class="header" href="#preconditioners">Preconditioners</a></h3>
<p>Preconditioning is typically related to reducing a condition number of the problem, via the application of a matrix transformation.
The preconditioned problem is then usually solved by an iterative method. There are a range of options for preconditioning matrices:</p>
<ul>
<li><code>DIC/DILU</code>: diagonal incomplete-Cholesky (symmetric) and incomplete-LU (asymmetric)</li>
<li><code>FDIC</code>: faster diagonal incomplete-Cholesky (DIC with caching, symmetric)</li>
<li><code>GAMG</code>: geometric-algebraic multi-grid.</li>
<li><code>diagonal</code>: diagonal preconditioning, not generally used</li>
<li><code>none</code>: no preconditioning.</li>
</ul>
<p>The pressure equation resolution usage is shown:</p>
<pre><code class="language-sh">    p
    {
        solver          PCG;
        preconditioner  DIC;
        tolerance       1e-06;
        relTol          0.05;
    }

    pFinal
    {
        $p;
        relTol          0;
    }
</code></pre>
<h2 id="solver-coupling-equations"><a class="header" href="#solver-coupling-equations">Solver (coupling equations)</a></h2>
<p>Whatever solver you use from above adopt a specific set of sequential algorithm such as semi-implicit
method for pressure-linked equations (SIMPLE), pressure-implicit split-operator (PISO) or PIMPLE.
These sequential algorithms are iterative procedures for coupling equations for momentum and mass conservation,
PISO and PIMPLE being used for transient problems and SIMPLE for steady-state.</p>
<p>All the algorithms solve the same governing equations, they differ in how they loop over the equations.
The looping is controlled by input parameters that are listed below. They are set in a dictionary named after the algorithm:</p>
<ul>
<li>
<p><code>nNonOrthogonalCorrectors</code>: used by all algorithms, specifies repeated
solutions of the pressure equation, used to update the explicit
non-orthogonal correction of the Laplacian term; typically set to 0
(particularly for steady-state) or 1.</p>
</li>
<li>
<p><code>nCorrectors</code>: used by PISO, and PIMPLE, sets the number of times the
algorithm solves the pressure equation and momentum corrector in
each step; typically set to 2 or 3.</p>
</li>
<li>
<p><code>nOuterCorrectors</code>: used by PIMPLE, it enables looping over the entire
system of equations within on time step, representing the total
number of times the system is solved; must be and is typically set
to 1, replicating the PISO algorithm.</p>
</li>
<li>
<p><code>momentumPredictor</code> switch those controls solving of the momentum
predictor; typically set to off for some flows, including low
Reynolds number and multiphase.</p>
</li>
</ul>
<h3 id="simple-solvers-practice"><a class="header" href="#simple-solvers-practice">SIMPLE solvers practice</a></h3>
<p>For the pressure equation:</p>
<pre><code class="language-c++">p
{
    solver GAMG;
    tolerance 1e-6;
    relTol 0.01;
    nPreSweeps 0;
    nPostSweeps 2;
    cacheAgglomeration on;
    agglomerator faceAreaPair;
    nCellsInCoarsestLevel 1000;
    mergeLevels 1;
}
</code></pre>
<p>After a while it should be good practice to lower the relative tollerance to <code>relTol: 0.0</code> to let mamage
the tolerance as an absolute criteria. While for the velocity:</p>
<pre><code class="language-c++">U
{
    solver GAMG;
    smoother &lt;smoother&gt;;
    tolerance 1e-6;
    relTol 0.0;
    nPreSweeps 0;
    nPostSweeps 2;
    cacheAgglomeration on;
    agglomerator faceAreaPair;
    nCellsInCoarsestLevel 1000;
    mergeLevels 1;
}
</code></pre>
<h3 id="piso--pimple-solvers-practice"><a class="header" href="#piso--pimple-solvers-practice">PISO &amp; PIMPLE solvers practice</a></h3>
<p>You must do at least one corrector step when using PISO solvers.
When you use the PISO and PIMPLE solvers, you also have the option to set the
tolerance for the final corrector step (<code>*Final</code>).
By proceeding in this way, you can put all the computational effort only in the last
corrector step (<code>*Final</code>).</p>
<pre><code class="language-c++">p
{
    solver GAMG;
    smoother &lt;smoother&gt;;
    tolerance 1e-04;
    relTol 0.01;
    nPreSweeps 0;
    nPostSweeps 2;
    cacheAgglomeration on;
    agglomerator faceAreaPair;
    nCellsInCoarsestLevel 1000;
    mergeLevels 1;
}

pFinal
{
    solver GAMG;
    smoother &lt;smoother&gt;;
    tolerance 1e-06;
    relTol 0.0;
    nPreSweeps 0;
    nPostSweeps 2;
    cacheAgglomeration on;
    agglomerator faceAreaPair;
    nCellsInCoarsestLevel 1000;
    mergeLevels 1;
}
</code></pre>
<h4 id="addtional-notes"><a class="header" href="#addtional-notes">Addtional notes</a></h4>
<p>Set to yes the momentumPredictor for high Reynolds flows, where convection dominates:</p>
<pre><code class="language-c++"> momentumPredictor yes;
</code></pre>
<p>Recommended value is 1 (equivalent to PISO).
Increase to improve the stability of second
order time discretization schemes (LES
simulations). Increase for strongly coupled
problems.</p>
<pre><code class="language-c++">nOuterCorrectors 1; 
</code></pre>
<p>Recommended to use at least 3 correctors.
It improves accuracy and stability. Use 4 or
more for highly transient flows or strongly
coupled problems.</p>
<pre><code class="language-c++"> nCorrector 3; 
</code></pre>
<p>Recommend to use at least 1 corrector.
Increase the value for bad quality meshes.</p>
<pre><code class="language-c++"> nNonOrthogonalCorrectors 1; 
</code></pre>
<p>The orthogonality correctors must be raised once the mesh starts to be highly orthogonal.</p>
<div class="table-wrapper"><table><thead><tr><th>Non-orthogonality</th><th>between 70 and 85</th><th>between 60 and 70</th><th>less than 60</th></tr></thead><tbody>
<tr><td>nNonOrthogonalCorrectors</td><td>3</td><td>2</td><td>1</td></tr>
</tbody></table>
</div>
<p>Flag to indicate whether to solve the turbulence on the final pimple iteration only. For Scale-Resolving
Simulation (SRS) the recommended value is false (the default is true)</p>
<pre><code class="language-c++"> turbOnFinalIterOnly false; 
</code></pre>
<h2 id="under-relaxation-factors"><a class="header" href="#under-relaxation-factors">Under-relaxation factors</a></h2>
<p>The relaxation factors for under-relaxaing the fields variable are specified within
<code>fvSolution.relaxationFactors.fields</code> sub-dictionary, instead
equation under-relaxations factor are within a <code>fvSolution.relaxationFactors.equations</code> sub-dictionary. </p>
<h3 id="simple"><a class="header" href="#simple">SIMPLE</a></h3>
<p>Usual set of parameters for under-relaxaing the problem using a SIMPLE scheme:</p>
<pre><code class="language-c++">p 0.3;
U 0.7;
k 0.7;
omega 0.7;
</code></pre>
<h3 id="simplec"><a class="header" href="#simplec">SIMPLEC</a></h3>
<p>Usual set of parameters for under-relaxaing the problem using a SIMPLEC scheme:</p>
<pre><code class="language-c++">p 1;
U 0.9;
k 0.9;
omega 0.9;
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../../../footers/footer_third_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="decomposepardict"><a class="header" href="#decomposepardict">decomposeParDict</a></h1>
<p>The dictionary decomposeParDict is read by the utility</p>
<pre><code class="language-sh">decomposePar
</code></pre>
<p>The utility divides the domain in blocks which will
be solved by a single core each, hence the domain must be divided in the same parts as permitted parallel processes i.e. cores.</p>
<p>It is advised to use the <code>scotch;</code> option
if the domain cannot be subdivided in sections with the same amourt of cells inside.
Use the command to overwrite an already decomposed case:</p>
<pre><code class="language-sh">decomposePar -force
</code></pre>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<pre><code class="language-c++">FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    object      decomposeParDict;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

numberOfSubdomains 16;                  // Must be the same number you will during your simulation resolution

method          hierarchical;          
//method          scotch;

coeffs                                  //
{                                       //
    n           (2 2 4);                //  No need if method is: scotch
}                                       //

</code></pre>
<p>The more versatile but not very efficient division algorithm is instantiated like the following example:</p>
<pre><code class="language-c++">FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    object      decomposeParDict;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

numberOfSubdomains  4;

method          scotch;
// method          hierarchical;
// method          simple;
// method          manual;

coeffs
{
    n           (2 2 1);
    dataFile    "decompositionData";
}

scotchCoeffs
{
    //processorWeights ( 1 1 1 1 );
    //writeGraph  true;
    //strategy "b";
}

/*
constraints
{
    //- Keep owner and neighbour on same processor for faces in zones:
    faces
    {
        type    preserveFaceZones;
        zones   (heater solid1 solid3);
    }
}
*/


// ************************************************************************* //
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../../footers/footer_second_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fvoptions"><a class="header" href="#fvoptions">fvOptions</a></h1>
<p>This dictionary defines optional properties the case adopt, such as
porosity value, temperature limiters, etc.
The document once it is written does not require an utility to be applicable
because it is directly read by the solver.</p>
<h2 id="limiting-the-temperature-field"><a class="header" href="#limiting-the-temperature-field">Limiting the temperature field</a></h2>
<p>The following dictionary set the max and min temperature allowed in the domain.</p>
<pre><code class="language-sh">FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    object      fvOptions;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

limitT
{
    type       limitTemperature;
    min        300;
    max        460;
    selectionMode all;
}

//************************************************************************** //
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../../footers/footer_second_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="toposetdict"><a class="header" href="#toposetdict">topoSetDict</a></h1>
<p>This dictionary become more easy the more get exposed to it. Few example of topoSetDict are given.</p>
<h2 id="divide-the-domain-in-4-domains-with-different-properties"><a class="header" href="#divide-the-domain-in-4-domains-with-different-properties">Divide the domain in 4 domains with different properties</a></h2>
<pre><code class="language-c++">FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    location    "system";
    object      topoSetDict;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

actions
(   
/*   // FaceZones
        {
                name baffleSET;
                type faceSet;
                action new;
                //source       searchableSurfaceToCell;
                //surfaceType  triSurfaceMesh;
                //surfaceName  copper.stl;

source      surfaceToCell;
    file    copper.stl;
    }
    {
        name        baffle;
        type        faceZoneSet;
        action      new;
        source      setToFaceZone;
        faceSet     baffleSET;
    }
*/
//  --------------------------------------------------------------------------------------------

   // CellZones
    {
        name           notPCB;
        type           cellSet;
        action         new;
        source         zoneToCell;
        zones          ( water air hydrogen);
    }
    {
        name    solid;
        type    cellSet;
        action  new;
        source  boxToCell;
        box     (-1 -1 -1) (1 1 1);
    }
    {
        name    solid;
        type    cellSet;
        action  subtract;     
        source  cellToCell;   // select all the cells from given cellSet(s).
        set     notPCB ;
    }
    {
        name    PCB;
        type    cellZoneSet;
        action  new;
        source  setToCellZone;
        set     solid ;
    }

);

// ************************************************************************* //
</code></pre>
<p>This dictonary is triggered using:</p>
<pre><code class="language-sh">topoSet  &gt; ./log/topoSet  &amp;&amp; echo "topoSet Executed"
</code></pre>
<p>It will return 4 different cellZones, those cellZones can be then addressed as different region of the mesh.</p>
<pre><code class="language-sh">splitMeshRegions -cellZonesOnly -overwrite &gt; ./log/splitMesh.log 2&gt;&amp;1 &amp;&amp; echo "splitMeshRegions Executed"
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../../footers/footer_second_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="problem-initialization"><a class="header" href="#problem-initialization">Problem initialization</a></h1>
<p>From a a brand new case where no available data are in place from previous solution, run the laplacian solver:</p>
<pre><code class="language-sh">potentialFoam
</code></pre>
<p>this solver act only on velocity file chainging its potential to overwrite <code>0/U</code> with to get an
approximate solution of the field.</p>
<h2 id="interpolation-from-previous-solution"><a class="header" href="#interpolation-from-previous-solution">Interpolation from previous solution</a></h2>
<p>Instead,if data are present from a previous solution it is possible
to map the fields to interpolate the results on the new mesh, running:</p>
<pre><code class="language-sh">mapFields -consistent -sourceTime &lt;iterationNumber&gt; &lt;pathOfTheBaseCase&gt;
</code></pre>
<p>This will overwrite <code>0/*</code> with the value of
the case interpolating the result in the mesh in interest. If you do not
specify the flag "-consistent", it is necessary build a mapFieldsDict (not adivced).</p>
<p>To reorder the indexing of the matrix to get the more sparse matrix as possible, before launching the calculation use:</p>
<pre><code class="language-sh">renumberMesh
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="modularity"><a class="header" href="#modularity">Modularity</a></h1>
<p>A modular way to proceed during the study, especially when a list of commands starts to be extentive is to use the <code>make</code>
utility instead of creating a bash script. First, we have to write the case inside a Makefile at the root of our project similarly to:</p>
<pre><code class="language-bash">All: mesh parprep run reconstruct view
mesh: baseMesh regionMesh electrolyteMesh splitMesh

###############

clean:
        (rm -rf *.log [1-9]* error output proc* 0 time *.foam log stop);
        (./src/Allclean)
###############

baseMesh:
        # snappyHexMesh for mesh generation
        (blockMesh)
        (surfaceFeatureExtract)
        (snappyHexMesh -overwrite)

        # redefine zones
        (rm -f constant/polyMesh/sets/*)
        (topoSet -dict system/topoSetDict.cellZones)
        (rm -f constant/polyMesh/*Zones)
        (setsToZones)

regionMesh:
        # split mesh
        (splitMeshRegions -cellZonesOnly -overwrite)

        # copy submeshes...
        (cp -r constant/air/polyMesh subRegions/air/constant/.)
        (cp -r constant/fuel/polyMesh subRegions/fuel/constant/.)
        (cp -r constant/interconnect0/polyMesh subRegions/interconnect0/constant/.)
        (cp -r constant/interconnect1/polyMesh subRegions/interconnect1/constant/.)

        # give space for electrolyte region
        (transformPoints -translate '(0 0  2e-5)' -case "subRegions/air")
        (transformPoints -translate '(0 0 -2e-5)' -case "subRegions/fuel")
        (transformPoints -translate '(0 0  2e-5)' -case "subRegions/interconnect0")
        (transformPoints -translate '(0 0 -2e-5)' -case "subRegions/interconnect1")

electrolyteMesh:
        # generate electrolyte region
        (extrudeMesh)
        (topoSet -dict system/topoSetDict.faceSets)
        (createPatch -overwrite -dict system/createPatchDict.electrolyte)
        (rm -f constant/polyMesh/sets/*)
        (topoSet -dict system/topoSetDict.electrolyte)
        (rm -f constant/polyMesh/*Zones)
        (setsToZones)
        (rm -f constant/polyMesh/sets/*)

        # merge mesh
        (mergeMeshes . subRegions/air -overwrite)
        (mergeMeshes . subRegions/fuel -overwrite)
        (mergeMeshes . subRegions/interconnect1 -overwrite)
        (mergeMeshes . subRegions/interconnect0 -overwrite)

        (rm -rf 0)

        # stitch mesh
        (stitchMesh -perfect interconnect1_to_fuel fuel_to_interconnect1 -overwrite)
        (stitchMesh -perfect interconnect0_to_air air_to_interconnect0 -overwrite)
        (stitchMesh -perfect fuel_to_air electrolyte_to_fuel -overwrite)
        (stitchMesh -perfect air_to_fuel electrolyte_to_air -overwrite)

        (rm -rf 0)

        (attachMesh)

splitMesh:
        (rm -f constant/polyMesh/sets/*)
        (topoSet -dict system/topoSetDict.splitMesh)
        (rm -f constant/polyMesh/*Zones)
        (setsToZones)

        (topoSet -dict system/topoSetDict.inletOutlet)
        (createPatch -overwrite -dict system/createPatchDict.inletOutlet)

        (splitMeshRegions -cellZonesOnly -overwrite)

        # air region
        #
        (topoSet -region air)
        (setsToZones -region air)

        # fuel region
        #
        (topoSet -region fuel)
        (setsToZones -region fuel)

        # electrolyte region
        #
        (topoSet -region electrolyte)
        (setsToZones -region electrolyte)

        (topoSet -dict system/topoSetDict.noCut)

        # delete
        #
        (rm -rf constant/interconnect0)
        (rm -rf constant/interconnect1)

        (rm -rf system/interconnect0)
        (rm -rf system/interconnect1)

        # mv 0 back
        (rm -rf 0)
        (cp -r src/0 .)

parallelPreparation:
        (rm -fr proc*)
        (./src/parallelPreparation.sh | tee log.parallelPreparation);

#############

parallelRun:
        (./src/parallelRun | tee log.parallelRun);
singleProcessRun:
        (fuelCellFoam | tee log.srun);

#############

reconstruct:
        (reconstructParMesh);
        (reconstructParMesh -region air -constant);
        (reconstructParMesh -region fuel -constant);
        (reconstructParMesh -region electrolyte -constant);
        (reconstructParMesh -region interconnect -constant);
        (reconstructPar);
        (reconstructPar -region air);
        (reconstructPar -region fuel);
        (reconstructPar -region electrolyte);
        (reconstructPar -region interconnect);
#############

view:
        (foamToVTK -latestTime);
        (foamToVTK -latestTime -region air);
        (foamToVTK -latestTime -region fuel);
        (foamToVTK -latestTime -region electrolyte);
        (foamToVTK -latestTime -region interconnect);
viewAll:
        (foamToVTK);
        (foamToVTK -region air);
        (foamToVTK -region fuel);
        (foamToVTK -region electrolyte);
        (foamToVTK -region interconnect);
</code></pre>
<p>It is possible to execute all the commands at once with:</p>
<pre><code class="language-console">make All
</code></pre>
<p>Otherwise, only portion of the study can be executed such as:</p>
<pre><code class="language-console">make baseMesh
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="browse-source-code"><a class="header" href="#browse-source-code">Browse Source Code</a></h1>
<p>The best source of information is the source code and the Doxygen documentation.</p>
<h2 id="source-code"><a class="header" href="#source-code">Source code</a></h2>
<p>The source code of the solver (executable, not library) and governing equations solved are
described following the source code located in the directory <code>$FOAM_SOLVERS</code></p>
<p>Looking at the directory as example:</p>
<pre><code class="language-sh">tree /opt/OpenFOAM/OpenFOAM-v2206/applications/solvers/heatTransfer/buoyantBoussinesqSimpleFoam
</code></pre>
<p>It will return the source code that builds the equation of your solver</p>
<pre><code class="language-sh">.
├── buoyantBoussinesqSimpleFoam.C
├── createFields.H
├── Make
│   ├── files
│   └── options
├── pEqn.H
├── readTransportProperties.H
├── TEqn.H
└── UEqn.H
</code></pre>
<p>Other sources can be searched around. I.g: To find where the source code
for the boundary condition "slip" is located:</p>
<pre><code class="language-sh">find $FOAM_SRC -name "*slip*"
</code></pre>
<p>Contoruring <code>slip</code> with <code>*</code> will make <code>find</code> able to find the word even inside a more complex title</p>
<h2 id="doxigen"><a class="header" href="#doxigen">Doxigen</a></h2>
<p>The directory <code>$WM_PROJECT_DIR/doc</code> contains the Doxygen documentation
of OpenFoam®. Before using the Doxygen documentation, you will need to
compile it. To compile the Doxygen documentation, from the terminal:</p>
<pre><code class="language-sh">cd $WM_PROJECT_DIR
./Allwmake doc
</code></pre>
<blockquote>
<p><b>Note</b>: You will need to install doxygen and graphviz/dot.</p>
</blockquote>
<p>After compiling the Doxygen documentation,
you can use it by typing:</p>
<pre><code class="language-sh">firefox file://$WM_PROJECT_DIR/doc/Doxygen/html/index.html
</code></pre>
<p>As a notice we say that the compilation is time consuming.</p>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="parallel-execution"><a class="header" href="#parallel-execution">Parallel execution</a></h1>
<p>After having completed the domain decomposition via the
<code>decomposePar</code> utility, the following commands does the same actions, where
process is intended either as solver or mesher:</p>
<pre><code class="language-sh"># 1st
mpirun -np &lt;\cores\&gt; &lt;\solver\&gt; -parallel &gt; iterations.log &amp;
# 2nd - equivalent commands
foamJob -parallel &lt;\solver\&gt;
</code></pre>
<p>To take full advantage of the hardware, use the maximum number of physical cores, remember to disable the
hyperthreading on the machine you are running. The output of the previous command writes a log file that
records either events that occur in the machine to monitor the simulation.</p>
<pre><code class="language-sh">#Live scrolling
tail -f  iteration.log
# Static scrolling
tail -&lt;\linesToDisplay\&gt;       
</code></pre>
<p>When the simulation is finished, all you time-step/iteration are in the
processor’s folder, to build a single case the following command it is
needed:</p>
<pre><code class="language-sh">reconstructParMesh
reconstructPar
</code></pre>
<p>If you need to kill the process in parallel, check top at first and the
execute:</p>
<pre><code class="language-sh">pkill &lt;\processName\&gt;
</code></pre>
<p>if for some reason the process does not close, given the fact OpenFOAM® processes
are not vital for the system you can force the kill using :</p>
<pre><code class="language-sh">kill -9
</code></pre>
<h2 id="parallelization-issues"><a class="header" href="#parallelization-issues">Parallelization issues</a></h2>
<p>Given the case the <code>0</code> directory has not been set before the case decomposition,
what you can recover the mesh reconstructing it and then decompose it again with annex
the <code>0</code> folder in place following this series of command at meshing done::</p>
<pre><code class="language-sh">reconstructParMesh -constant
restore0Dir
decomposePar -force
</code></pre>
<p>When it is reconstructed only the mesh, and decomposed a second time to include the
0 directory, an error can occur when trying to reconstruct at the conclusion of the
case. A solution is to run:</p>
<pre><code class="language-sh">reconstructParMesh -constant &amp;&amp; reconstructPar -latestTime
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mpi-message-passage-interface"><a class="header" href="#mpi-message-passage-interface">MPI (Message Passage Interface)</a></h1>
<p>It is a standard, not an implementation. Hence it is not:</p>
<ul>
<li>a compiler</li>
<li>a library</li>
<li>a framework</li>
<li>a programming language</li>
</ul>
<p>It is the standard for paralleal computing in distributed system with distributed memory.
OpenMPI is one of its implementation (other flavours are avilable, i.g. Intel® MPI Library).</p>
<h2 id="openmpi"><a class="header" href="#openmpi">OpenMPI</a></h2>
<p>In general, Open MPI requires that its executables are in your PATH on every node that you will run on
and if Open MPI was compiled as dynamic libraries (which is the default), the directory where its libraries
are located must be in your LD_LIBRARY_PATH on every node.</p>
<p>Specifically, if OpenMPI was installed with a prefix of <code>/opt/openmpi</code>, then the following should
be in your PATH and LD_LIBRARY_PATH</p>
<ul>
<li>PATH:            /opt/openmpi/bin</li>
<li>LD_LIBRARY_PATH: /opt/openmpi/lib</li>
</ul>
<p>Depending on your environment, you may need to set these values in your shell startup files (e.g., .profile, .bashrc, etc.).</p>
<h3 id="jobs-launch-with-slurm-simple-linux-utility-for-resource-management"><a class="header" href="#jobs-launch-with-slurm-simple-linux-utility-for-resource-management">Jobs launch with SLURM (Simple Linux Utility for Resource Management)</a></h3>
<blockquote>
<p>Open MPI provides the commands <code>mpirun</code> and <code>mpiexec</code> to launch MPI jobs.</p>
</blockquote>
<p>Open MPI supports launching parallel jobs in all three methods that Slurm supports:</p>
<ul>
<li>Launching via "salloc ..."</li>
<li>Launching via "sbatch ..."</li>
<li>Launching via "srun -n X my_mpi_application"</li>
</ul>
<p>Specifically, you can launch MPI's mpirun in an interactive Slurm allocation (via the salloc command) or you can submit a
script to Slurm (via the sbatch command), or you can "directly" launch MPI executables via srun.</p>
<p>OpenMPI automatically obtains both the list of hosts and how many processes to start on each host from Slurm directly.
Hence, it is unnecessary to specify the --hostfile, --host, or -np options to mpirun. OpenMPI use Slurm-native mechanisms
to launch and kill processes (rsh and/or ssh are not required).</p>
<p>For example:</p>
<pre><code class="language-sh"># Allocate a Slurm job with 4 nodes
salloc -N 4 sh
# Now run an Open MPI job on all the nodes allocated by Slurm
mpirun my_mpi_application
</code></pre>
<p>This will run the 4 MPI processes on the nodes that were allocated by Slurm. Equivalently, you can do this:</p>
<pre><code class="language-sh"># Allocate a Slurm job with 4 nodes and run your MPI application in it
salloc -N 4 mpirun my_mpi_aplication
</code></pre>
<p>Or, if submitting a script like:</p>
<pre><code class="language-sh">#!/bin/sh
mpirun my_mpi_application
</code></pre>
<p>with:</p>
<pre><code class="language-sh">sbatch -N 4 my_script.sh
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cluster-practices"><a class="header" href="#cluster-practices">Cluster practices</a></h1>
<p>OpenFoam® has been designed to run in a distributed memory system. This means that each core or node has
a memory of its own and does not require locks like shared memory. Distributed memory uses a collection
of independent core memory pairs that synchronize using a network.</p>
<p>OpenMPI is an implementation of the Message Passing Interface (MPI) used to permit at the system to
communicate via a distributed memory.</p>
<h2 id="environment-setup"><a class="header" href="#environment-setup">Environment setup</a></h2>
<p>Check what modules are installed:</p>
<pre><code class="language-sh">module avail
</code></pre>
<p>A <code>module</code> refers to a collection of software packages or libraries that is available on a system.
The <code>module load</code> command is used to load specific modules into the user's environment.</p>
<p>The default environment is typically a minimal set of software packages and libraries needed to run basic commands.
However, there may be many additional software packages and libraries available on the cluster, and these can be
loaded into the user's environment as needed using the "module load" command.</p>
<p>Once a module is loaded, its associated executables, libraries, and environment variables become available to the
user's session.</p>
<pre><code class="language-bash">#!/bin/bash
#SBATCH --job-name=OF-Job
#SBATCH --ntasks=36
#SBATCH --output=%x_%j.out
#SBATCH --constraint=c5.18xlarge

#------------------------------------------------------------------------------

module load openmpi                                         # MPI module upload
source /fsx/programs/OpenFOAM®/OpenFOAM®-v2112/etc/bashrc   # Source OpenFOAM® binaries
source ${WM_PROJECT_DIR:?}/bin/tools/RunFunctions           # Source OpenFOAM® run functions

#------------------------------------------------------------------------------

rm -r log; mkdir log
restore0Dir
decomposePar -force &gt; ./log/decomposePar.log 2&gt;&amp;1
mpirun -np $SLURM_NTASKS checkMesh -parallel  &gt; ./log/checkMesh.log 2&gt;&amp;1
mpirun -np $SLURM_NTASKS redistributePar -parallel -overwrite  &gt; ./log/redistributePar.log 2&gt;&amp;1
mpirun -np $SLURM_NTASKS renumberMesh -parallel -overwrite -constant  &gt; ./log/renumberMesh.log 2&gt;&amp;1
mpirun -np $SLURM_NTASKS patchSummary -parallel  &gt; ./log/patchSummary.log 2&gt;&amp;1
mpirun -np $SLURM_NTASKS potentialFoam -parallel  &gt; ./log/potentialFoam.log 2&gt;&amp;1

#------------------------------------------------------------------------------

mpirun -np $SLURM_NTASKS $(getApplication) -parallel   &gt; ./log/$(getApplication).log 2&gt;&amp;1
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="compressible-model"><a class="header" href="#compressible-model">Compressible model</a></h1>
<p>The Navier-Stokes equations consist of a time-dependent continuity equation for conservation of mass, three
time-dependent conservation of momentum equations, and a time-dependent conservation of energy equation.</p>
<p>\begin{equation}
\tag{1}
\frac{\partial \rho}{\partial t} + \frac{\partial(\rho u_{i})}{\partial x_{i}} = 0
\end{equation}</p>
<p>\begin{equation}
\tag{2}
\frac{\partial (\rho u_{i})}{\partial t} + \frac{\partial[\rho u_{i}u_{j}]}{\partial x_{j}} = -\frac{\partial p}{\partial x_{i}} + \frac{\partial \tau_{ij}}{\partial x_{j}} + \rho f_{i}
\end{equation}</p>
<p>\begin{equation}
\tag{3}
\frac{\partial (\rho e)}{\partial t} + (\rho e+p)\frac{\partial u_{i}}{\partial x_{i}} = \frac{\partial(\tau_{ij}u_{j})}{\partial x_{i}} + \rho f_{i}u_{i} + \frac{\partial(\dot{ q_{i}})}{\partial x_{i}} + r
\end{equation}</p>
<p>The general transport is in words:</p>
<ul>
<li>[Rate of increase of fluid element] + [Net rate of flow of fluid element] = [Rate of increase of diffusion] + [Rate of increase of sources]</li>
</ul>
<h2 id="compressible-resolution"><a class="header" href="#compressible-resolution">Compressible resolution</a></h2>
<p>To solve a compressible flow problem, you have to solve all five equations simultaneously; hence a coupled system
of equations. There are actually some other equations that are required to solve this system. We only show five
equations for six unknowns (u, v, w, p, ρ, T). The pressure, temperature, and density of a gas are all related by
an equation of state (p = p(ρ, T)).</p>
<h2 id="incompressible-resoulution"><a class="header" href="#incompressible-resoulution">Incompressible resoulution</a></h2>
<p>To solve for incompressible flow problems, density is constant and, hence, by definition, not linked to the pressure.
In this case, coupling between pressure and velocity introduces a constraint in the solution of the flow field because
there are 4 equations and 6 unknowns.</p>
<p>So, we need to do this by using a segregated algorithm (i.g. SIMPLE); we need to guess the velocity and pressure field.
The convective fluxes through cell faces are evaluated from guessed velocity components, and a guessed pressure field is
used to solve the momentum equations.</p>
<p>A pressure correction equation is derived from the continuity and momentum equations, and that pressure correction
equation is solved to obtain a pressure correction field, which is in turn used to update the velocity and pressure
fields that will satisfy the continuity equation, and again the momentum equation is solved by updated pressure and
velocity fields until we get a converged solution.</p>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="multiphase-model"><a class="header" href="#multiphase-model">Multiphase model</a></h1>
<p>Multiphase models can put in place simulations with liquid-liquid, liquid-gas, gas-gas and fluid-solid interactions.
One of the more simple multiphase solver is:</p>
<pre><code class="language-sh">interFoam
</code></pre>
<p>Which solves the Navier Stokes equations for two incompressible, isothermal immiscible fluids. That means that the material properties are constant in the region filled by one of the two fluid except at the interphase. Transferrable, a similar pattern is present fot all the multiphase solver hence additional set-up must take place to deliver a simulation with more than one phase.</p>
<h2 id="set-up"><a class="header" href="#set-up">Set-up</a></h2>
<p>In a multiphase simulation you need to define the phase properties and its interaction through the <code>constant</code> directory.
Looking at the necessary file to run a more complex solver for liquid/gasseous interaction in a disperse phase like <code>twoPhaseEulerFoam</code>.
The <code>constant</code> directory should look like this:</p>
<pre><code class="language-sh">constant
├── phaseProperties
├── thermophysicalProperties.hydrogen
├── thermophysicalProperties.water
├── turbulenceProperties.hydrogen
└── turbulenceProperties.water
</code></pre>
<p>It this scenario we have the liquid phase as water, describing its theral behaviour in <code>thermophysicalProperties.water</code></p>
<pre><code class="language-c++">    ...
    object      thermophysicalProperties.water;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

thermoType
{
    type            heRhoThermo;
    mixture         pureMixture;
    transport       const;
    thermo          hConst;
    equationOfState rhoConst;
    specie          specie;
    energy          sensibleInternalEnergy;
}

mixture
{
   equationOfState
    {
        rho             983.2;              // density     [kg/m^3]   at 60°C  
    }
    specie
    {
        molWeight       18.01528;           // water molecular weight   [g/mol]
    }
    thermodynamics
    {
        Cp              4190;               // Specific Heat at 90°C         [J/Kg K]
        Hf              0;                  // Heat of fusion - 0 in single phase
    }
    transport
    {
        mu              4.66E-04;           // dynamic viscosity at 90°C   [Kg/m s]
        Pr              2.98;               // Prandtl Number at 90°C      [nu/alfa] = [mu Cp/k] [-]    
    }
}
</code></pre>
<p>While the interaction between the two phases should look something like:</p>
<pre><code class="language-c++">FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    object      phaseProperties;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

type isothermalPhaseModel ;
phases          (hydrogen water);

hydrogen
{
    diameterModel   isothermal;
    isothermalCoeffs
    {
        d0              3e-5;
        p0              1e5;
    }
    residualAlpha   1e-6;
}

water
{
    diameterModel   constant;
    constantCoeffs
    {
        d               1e-6;
    }
    residualAlpha   1e-6;
}

blending
{
    default
    {
        type            linear;
        maxFullyDispersedAlpha.hydrogen 0.7;
        maxPartlyDispersedAlpha.hydrogen 0.7;
        maxFullyDispersedAlpha.water 0.7;
        maxPartlyDispersedAlpha.water 0.7;
    }
}

sigma
(
    (hydrogen and water)     0.07
);

aspectRatio
(
    (hydrogen in water)
    {
        type            constant;
        E0              1.0;
    }

    (water in hydrogen)
    {
        type            constant;
        E0              1.0;
    }
);

drag
(
    (hydrogen in water)
    {
        type            SchillerNaumann;
        residualRe      1e-3;
        swarmCorrection
        {
            type        none;
        }
    }

    (water in hydrogen)
    {
        type            SchillerNaumann;
        residualRe      1e-3;
        swarmCorrection
        {
            type        none;
        }
    }

    (hydrogen and water)
    {
        type            segregated;
        residualAlpha   1e-6;
        m               0.5;
        n               8;
        swarmCorrection
        {
            type        none;
        }
    }
);

virtualMass
(
    (hydrogen in water)
    {
        type            constantCoefficient;
        Cvm             0.5;
    }

    (water in hydrogen)
    {
        type            constantCoefficient;
        Cvm             0.5;
    }
);

heatTransfer
(
    (hydrogen in water)
    {
        type            RanzMarshall;
        residualAlpha   1e-3;
    }

    (water in hydrogen)
    {
        type            RanzMarshall;
        residualAlpha   1e-3;
    }
);

lift
(
);

wallLubrication
(
);

turbulentDispersion
(
);

// Minimum allowable pressure
pMin            10000;

</code></pre>
<p>where <code>sigma</code> is the surface tension between the interfaces</p>
<p>If you change the name of the fluid in phases (water air); there is the
need change the extension of the name as well in 0 because the nomenclature
must be consistent:</p>
<pre><code>0
├── alpha.hydrogen
├── p
├── p_rgh
├── Theta
├── T.hydrogen
├── T.water
├── U.hydrogen
└── U.water
</code></pre>
<p>Even remember that the first material that you define in the first row of this document will be taken as the first term of the VOF (volume of
fluid) equation.</p>
<blockquote>
<p><b>Warning:</b> In fvSolutions miss the keyword
cAlpha 1.0 to put in the section of alphaWater.*</p>
</blockquote>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="conjugate-heat-transfer-model"><a class="header" href="#conjugate-heat-transfer-model">Conjugate Heat Transfer Model</a></h1>
<p>Simulate the heat transfert between a solid and a fluid mean necessity a CHT model.
Several solvers that implements these model are present, the most common are called:</p>
<ul>
<li>
<p><b> chtMultiRegionFoam </b></p>
</li>
<li>
<p><b> chtMultiRegionSimpleFoam </b> → steady state version of chtMultiRegionFoam</p>
</li>
</ul>
<p>These allow the definition of multiple regions in the domain by setting up
computational meshes, models and conditions separately for each region,
including solid-only ones.</p>
<h2 id="region-characterization"><a class="header" href="#region-characterization">Region characterization</a></h2>
<p>In "constant/<regionName>/thermophysicalProperties" you have to be consistent with the nomenclature,
then in the dictionary section <code>thermophysicalProperties.thermo.type</code> you will usually set
"heRhoThermo" for setting the fluid region and "heSolidThermo" for the solid region other then defining
the file "constant/regionProperties" such as:</p>
<pre><code class="language-c#">    ...
    object      regionProperties;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

regions
(
    fluid       (fluid_domain)
    solid       (aluminum gold regionNameN)
);
</code></pre>
<h2 id="mesh-partition-practice"><a class="header" href="#mesh-partition-practice">Mesh partition practice</a></h2>
<p>At first you must define different regions, using the <code>topoSet</code> utility ( which
follows "system/topoSetDict") to set different cellZones:</p>
<pre><code class="language-sh">topoSet
</code></pre>
<p>An example of topoSet can be the following one, which separates threee fluid with a solid region,
and apply a face zone:</p>
<pre><code class="language-c++">...
    object      topoSetDict;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

actions
(
   FaceZones
    {
            name copperLayerAirSET;
            type faceSet;
            action new;
            source patchToFace;
            sourceInfo { patch copperLayerAir; }
    }

    {
        name      copperLayerAir;
        type      faceZoneSet;
        action    new;
        source    setToFaceZone;
        faceSet   copperLayerAirSET;
    }
    
   // CellZones
    {
        name           notPCB;
        type           cellSet;
        action         new;
        source         zoneToCell;
        zones          ( water air hydrogen);
    }
    {
        name    solid;
        type    cellSet;
        action  new;
        source  boxToCell;
        box     (-1 -1 -1) (1 1 1);
    }
    {
        name    solid;
        type    cellSet;
        action  subtract;
        source  cellToCell;   // select all the cells from given cellSet(s).
        set     notPCB ;
    }
    {
        name    PCB;
        type    cellZoneSet;
        action  new;
        source  setToCellZone;
        set     solid ;
    }

);

</code></pre>
<p>Then split the mesh to create interfaces and distinct regions to couple the CHT model:</p>
<pre><code class="language-sh">splitMeshRegions -cellZonesOnly -overwrite
</code></pre>
<p>This will overwrite a new mesh, divided into different CellZones.</p>
<pre><code class="language-sh">checkMesh -region &lt;nameRegion&gt;
</code></pre>
<h2 id="thermal-boundary-conditions"><a class="header" href="#thermal-boundary-conditions">Thermal boundary conditions</a></h2>
<p>Instead as BC in 0, for selecting the thermal conductivity aside of
kappaMethod you need to introduce the keywords:</p>
<ul>
<li>
<p><b> lookup </b> →  the used thermal conductivity is specified in the own
boundary field by means of the name kappa. kappa is the name of the
field.</p>
</li>
<li>
<p><b> fluidthermo </b> →  the used thermal conductivity is the one corresponding
to the fluid, specified in <material>/thermophysical</p>
</li>
<li>
<p><b>  solidthermo </b> →  the used thermal conductivity is the one corresponding
to the solid, specified in <material>/thermophysical</p>
</li>
<li>
<p><b> directionalSolidThermo </b> -&gt; the thermal conductivity is the one
corresponding to an orthotropic material, and it is specified in
<material>/thermophysical (directionalKSolidThermoCoeffs)</p>
</li>
</ul>
<h2 id="parallel-execution-with-multiple-regions"><a class="header" href="#parallel-execution-with-multiple-regions">Parallel execution with multiple regions</a></h2>
<p>To decompose a case with more than one region it is opportune that every region has
directives to decompose the case. An option is to create symbolic link to all your
decomposition files for consistency, such as:</p>
<pre><code class="language-sh">ln -s system/decomposeParDict system/&lt;solidRegion1&gt;/decomposeParDict
ln -s system/decomposeParDict system/&lt;fluidRegion1&gt;/decomposeParDict
</code></pre>
<p>Same applies to the "fvSolution" and "fvSchemes":</p>
<pre><code class="language-sh">ln -s system/fvSolution_solid_regions system/&lt;solidRegion1&gt;/fvSolution
ln -s system/fvSolution_solid_regions system/&lt;solidRegion2&gt;/fvSolution
</code></pre>
<p>Then decompose and run the case through:</p>
<pre><code class="language-bash">decomposePar -allRegions
mpirun -n &lt;nProcessors&gt;  $(getApplication) -parallel
</code></pre>
<h3 id="script-example"><a class="header" href="#script-example">Script example</a></h3>
<p>This script aims to show most of the commands that a CHT case usually require:</p>
<pre><code class="language-bash">#!/bin/bash

SLURM_NTASKS=16

./Allclean
source /opt/OpenFOAM/OpenFOAM-v2206/etc/bashrc           # Source the Openfoam binaries
source ${WM_PROJECT_DIR:?}/bin/tools/RunFunctions        # Source run functions
rm -r log;
mkdir log

for region in $(foamListRegions)
do
    rm -r constant/$region/polyMesh;
done
echo "Eliminated mesh create in old regions"

restore0Dir
surfaceFeatureExtract &gt; ./log/surfaceFeatureExtract.log 2&gt;&amp;1  &amp;&amp; echo "surfaceFeatureExtract Executed/n"
blockMesh  &gt; ./log/blockMesh.log 2&gt;&amp;1  &amp;&amp; echo "blockMesh Executed"
decomposePar -force  &gt; ./log/decomposePar1.log 2&gt;&amp;1 &amp;&amp; echo "decomposePar1 Executed"
mpirun -np $SLURM_NTASKS snappyHexMesh -parallel -overwrite &gt; ./log/snappyHexMesh.log 2&gt;&amp;1 &amp;&amp; echo "snappyHexMesh Executed"

##  ----------------------   PARALLEL CORES   -----------------------------------------------

mpirun -np $SLURM_NTASKS topoSet -parallel &gt; ./log/topoSet  2&gt;&amp;1 &amp;&amp; echo "topoSet Executed"
mpirun -np $SLURM_NTASKS splitMeshRegions -cellZonesOnly -overwrite -parallel &gt; ./log/splitMesh.log 2&gt;&amp;1 &amp;&amp; echo "splitMeshRegions Executed"
mpirun -np $SLURM_NTASKS checkMesh -parallel &gt; ./log/checkMesh-EVERYCELLZONES.log 2&gt;&amp;1 &amp;&amp; echo "checkMesh Executed"

## Create a new 0/regions/* following a single dictionry 
for region in $(foamListRegions)
do
  mpirun -np $SLURM_NTASKS changeDictionary -region $region -parallel &gt; ./log/changeDictionary.$region.log 2&gt;&amp;1
done
echo "changeDictionary Executed"

## ---------------------------  Calculations in parallel start -------------------------------------------------------

mpirun -np $SLURM_NTASKS $(getApplication) -parallel   &gt; ./log/$(getApplication).log 2&gt;&amp;1 &amp;&amp; echo "$(getApplication) Executed"
reconstructParMesh -constant -allRegions &gt; ./log/reconstructParMesh.log 2&gt;&amp;1
</code></pre>
<h3 id="thin-walls"><a class="header" href="#thin-walls">Thin walls</a></h3>
<p>For introducing thin walls inside your domain:</p>
<pre><code class="language-c++">thicknessLayers ( \&lt;thicknessOfTheLayer\&gt; );
kappaLayers ( \&lt;thermalConductivityOfTheLayer\&gt; );
</code></pre>
<p>Check the "constant/<regionName>/polyMesh/boundary" on to check the
interface type which should be of this kind type: solidThermo for the
solid and type: fluidThemo for the fluid. Other than that, it is necessary
that the interface will be declared as in "constant/<region1>/polyMesh/boundary"</p>
<pre><code class="language-c++">type: mappedWall
</code></pre>
<h3 id="baffles-generation"><a class="header" href="#baffles-generation">Baffles generation</a></h3>
<p>In thermal problems it is often necessary resolve thin walls. Hence baffle modelling result to be a good choice if the computaional power is not adapt to solve little features.</p>
<pre><code class="language-c++">    ...
    object      createBafflesDict;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

// Whether to convert internal faces only (so leave boundary faces intact).
// This is only relevant if your face selection type can pick up boundary
// faces.
internalFacesOnly true;

// Baffles to create.
baffles
{
    copperLayers
    {
        type        searchableSurface;
        surface     triSurfaceMesh;
        name        copperLayers.stl;

        patchPairs
        {
            type wall;      //mappedWall;

            sampleMode      nearestPatchFace;
            sameGroup       off;
            patchFields
            {
                p
                  {
                    type            calculated;
                    value           uniform 0;
                  }

                  T
                    {
                    type            compressible::thermalBaffle1D&lt;hConstSolidThermoPhysics&gt;;
                    thickness       uniform 35E-06;    // thickness [m]
                    qs              uniform 0;         // heat flux [W/m2]
                    value           uniform 350;

                    specie
                    {
                        molWeight   63.546;   // g/mol
                    }

                    transport
                    {
                        kappa   401;          // W/(m·K)
                    }

                    thermodynamics
                    {
                        Hf      0;
                        Cp      3900;
                    }

                    equationOfState
                    {
                        rho     8920;
                    }
                }
            }
        }
    }
}
</code></pre>
<p>Then the execution should look like the following example:</p>
<pre><code class="language-sh">createBaffles -region PCB  -overwrite &gt;  ./log/createBaffles  2&gt;&amp;1 &amp;&amp; echo "createBaffles Executed"
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="automating-boundary-conditions-writing"><a class="header" href="#automating-boundary-conditions-writing">Automating boundary conditions writing</a></h1>
<p>This prectice it is not necessary, but usually multiple regions in CHT studies are present and manually
managing the <code>0</code> directory dictionaries can be overwhelming. The utility <code>changeDictionary</code>
can be used to generate a set of dictionary from a sample:</p>
<pre><code class="language-sh">for region in $(foamListRegions)
do
  changeDictionary -region $region
done
</code></pre>
<p>To make this utility working your "system" directory must instanciate a similar layout:</p>
<pre><code class="language-sh">system
│
├── regionName1
│   ├── changeDictionaryDict
│   ├── decomposeParDict -&gt; ../decomposeParDict
│   ├── fvOptions -&gt; ../fvOptions
│   ├── fvSchemes
│   └── fvSolution
├── regionName2
│   ├── changeDictionaryDict
│   ├── createBafflesDict
│   ├── decomposeParDict -&gt; ../decomposeParDict
│   ├── fvOptions -&gt; ../fvOptions
│   ├── fvSchemes
│   └── fvSolution
├── topoSetDict
├── controlDict
└── ...
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="executing-exclusively-energy-equations"><a class="header" href="#executing-exclusively-energy-equations">Executing exclusively energy equations</a></h1>
<p>To avoid the resolution of the flow field, for example into a transient case
where the fluid will not change. You can insert the flag "frozenFlow" to jump this
step.</p>
<pre><code class="language-c++">SIMPLE
{
    momentumPredictor yes;
    nNonOrthogonalCorrectors 1;
    // Flag to indicate that the flow system of equations should not be evolved
    frozenFlow      true;
}
</code></pre>
<p>The fluid flow dynamic field (velocity and pressure) is instancaited by the first time step.</p>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="residuals"><a class="header" href="#residuals">Residuals</a></h1>
<p>The residuals are evaluated by substituting the iterations' solution into the
theretical equation, taking out the non-zero result; it is also normalised
to make it independent of the scale of the problem being analysed. Consequently,
before solving an equation for a particular field, the initial residual is evaluated based
on the current values of the field. After each solver iteration the
residual is re-evaluated. To terminate the case, the initial residual of
the field equations should fall below user-specified threshold values.</p>
<h4 id="check-convergence-on-turbulent-flows"><a class="header" href="#check-convergence-on-turbulent-flows">Check convergence on turbulent flows</a></h4>
<p>A simple trick to check the converge of the calculations properly, consits in checking
the \( ν_{t} \) convergence value since it is dependent from \( k \) and \(  ε \)
which both must converge to get a good \( ν_{t} \), hence it is one of the best indicator
of convergence.</p>
<h2 id="convergence-visualization"><a class="header" href="#convergence-visualization">Convergence visualization</a></h2>
<p>Residuals can be monitored via terminal live or in a log file afterwards. Nonetheless
solutions are present to generate charts:</p>
<h4 id="gnuplot"><a class="header" href="#gnuplot">GNUPlot</a></h4>
<p>GNUPlot (<code>gnuplot</code>) is program for plotting mathematical expressions and data, to install it use the following:</p>
<pre><code class="language-sh">sudo apt install gnuplot
</code></pre>
<p>Activate the object function in <code>/system/controlDict</code>:</p>
<pre><code class="language-c#">    ...
    functions
    {
        #includeFunc  residuals
        ...
    }
</code></pre>
<p>Then the simualtion can be started as:</p>
<pre><code class="language-sh">foamInfo residuals
foamGet residuals
foamRun &gt; log &amp;
foamMonitor -l ./postprocessing/0/residuals
</code></pre>
<h4 id="manual-gnuplot-file"><a class="header" href="#manual-gnuplot-file">Manual GNUPlot file</a></h4>
<p>A manual file for plotting the simualtion data follow:</p>
<pre><code class="language-sh">set logscale y
set title "Residuals"
set ylabel 'Residual'
set xlabel 'Iteration'
plot "&lt; cat log | grep 'Solving for Ux' | cut -d' ' -f9 | tr -d ','" title 'Ux' with lines,\
"&lt; cat log | grep 'Solving for Uy' | cut -d' ' -f9 | tr -d ','" title 'Uy' with lines,\
"&lt; cat log | grep 'Solving for Uz' | cut -d' ' -f9 | tr -d ','" title 'Uz' with lines,\
"&lt; cat log | grep 'Solving for omega' | cut -d' ' -f9 | tr -d ','" title 'omega' with lines,\
"&lt; cat log | grep 'Solving for k' | cut -d' ' -f9 | tr -d ','" title 'k' with lines,\
"&lt; cat log | grep 'Solving for p' | cut -d' ' -f9 | tr -d ','" title 'p' with lines
pause 1
reread
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="paraview"><a class="header" href="#paraview">ParaView</a></h1>
<p>To install it download the binary file from the ParaView website, un-tar
it. To call in the correct way ParaView, after having downloaded binary
file, put in your <code>~/.bashrc</code> file the installation directory and source
the file after that, so it each time the terminal is called the path
will be registered and you can call ParaView with command line command;
ParaView.</p>
<pre><code class="language-sh">export PATH= &lt;installationPath&gt;/ParaView-&lt;ParaViewVersion&gt;/bin:${PATH}
</code></pre>
<p>and then make this modification active for the same session</p>
<pre><code class="language-sh">source ./bashrc
</code></pre>
<p>There is the need to create a dummy file in the working directory to
make ParaView be able to read the OpenFOAM® format.</p>
<pre><code class="language-sh">touch &lt;nameOfTheCase&gt;.foam
</code></pre>
<p>If ParaView is installed on GNU-Linux system, it is convenient call it with command</p>
<pre><code class="language-sh">paraview &lt;nameOfTheCase&gt;.foam &amp;
</code></pre>
<p>The tag &amp; keeps the program in background so you can continue to use the
same terminal page. In Windows Subsystem for GNU-Linux (WSL) it is enough
terminate the installation and run the executable;</p>
<pre><code class="language-sh">ParaView.exe &lt;nameOfTheCase&gt;.foam
</code></pre>
<p>When ParaView return errors in reading, it could be possible to solve it
changing the case format, convert the result of the simulation in the VTK
format (Visualization Tool Kit), it makes easier the manipulation the file and the
properties contained on in. The following command convert the format from the
OpenFOAM native one to VTK one:</p>
<pre><code class="language-sh">foamToVTK
</code></pre>
<blockquote>
<p>WARNING: If you use pressure-based solver as simpleFoam, it is
necessary multiply the pressure for the density!!!</p>
</blockquote>
<h2 id="parallel-visualization-in-local-machine"><a class="header" href="#parallel-visualization-in-local-machine">Parallel visualization in local machine</a></h2>
<p>It is possible to parallelize the visualization task to deal with big
cases in your local machine, the simplest way is to enable the “Auto
MPI” mode through the following actions:</p>
<blockquote>
<p>paraview --&gt; Edit --&gt; Settings --&gt; Enabled advanced options (the cogwheel up right) --&gt;  Scroll down (or search for) “Multicore Support” --&gt; Enable AutoMPI and set the number of cores --&gt; restart ParaView.</p>
</blockquote>
<h2 id="huge-data-set-visualization"><a class="header" href="#huge-data-set-visualization">Huge data-set visualization</a></h2>
<p>When the user cope with a huge amount of data, it is necessary the usage of a cluster to help manage
the load and distribute it. However even a single machine user benefit from these techniques.</p>
<h3 id="nvidia-index"><a class="header" href="#nvidia-index">NVIDIA IndeX™</a></h3>
<p>A plug-in from NVIDIA called <b> NVIDIA IndeX™ </b> helps in resolving the problem.
It is a volume visualization tool, that takes advantage of the GPU’s to deliver real-time performance
on large datasets by distributing visualization workloads across a GPU-accelerated system.
If you have installed ParaView using a binary package provided by Kitware, then the plugin
is already included and it is possible to load via:</p>
<blockquote>
<p>paraview --&gt; Tools --&gt; Manage Plugins --&gt; pvNVIDIAIndex --&gt; Load selected</p>
</blockquote>
<h2 id="trouble-shooting-commons-problem"><a class="header" href="#trouble-shooting-commons-problem">Trouble shooting commons problem</a></h2>
<p>ParaView in latest version require drivers for OpenGL =&gt; 3 and in
certain OS (such as CentOS 7) this is not compatible, hence if the
installed OpenGL driver are not supported, try to launch ParaView
telling to follow the MESA drivers:</p>
<pre><code class="language-sh">MESA_GL_VERSION_OVERRIDE=3.2 paraview
</code></pre>
<p>Otherwise:</p>
<pre><code class="language-sh">paraview –mesa
</code></pre>
<p>Same if you need to use ParaView in a headless mode and a graphic card
is not available, but you still want to render on the server. You can
build ParaView with these options to overtake the problem:</p>
<pre><code class="language-sh">cmake -GNinja -DVTK\_OPENGL\_HAS\_OSMESA=ON -DVTK\_USE\_X=OFF -DPARAVIEW\_USE\_QT=OFF ../\&lt;locationParaViewSourceCode\&gt;
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pvserver"><a class="header" href="#pvserver">Pvserver</a></h1>
<p><code>pvserver</code> is a server side utility that permit to use ParaView headless and in
parallel in a remote location, which we assume will have the capacity to
visuality heavy cases. To be sure that the connection server/client work
be sure to have the same verison of paraview installed in both the machines.
Best practice before starting to work with <code>pvserver</code>, check that the port
used by the service (11111 by default) is free:</p>
<pre><code class="language-sh">netstat -na | grep 11111
</code></pre>
<p>If the port is listening, you can start the connection. For an accurate view of the listening ports and which programmes are
using those;</p>
<pre><code class="language-sh">sudo netstat -ltnp
</code></pre>
<p>the flags indicate respectively:</p>
<ul>
<li>l: display only listening sockets</li>
<li>t: display TCP connection</li>
<li>n: display addresses in a numerical form</li>
<li>p: display process ID/ Program name</li>
</ul>
<h3 id="serverclient-connection"><a class="header" href="#serverclient-connection">Server/Client connection</a></h3>
<table>
<thead>
<tr class="header">
<th><strong>Server side </strong></th>
<th><strong>Client side </strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>On the terminal execute:</p>
<p>mpiexec -np 4 pvserver</p>
<p>This command will establish a connection though the port 11111 (default for ParaView), if you want to specify a different port</p>
<p>mpiexec -np 4 pvserver --server-port=&lt;<strong>portNumber</strong>&gt;</p>
<p>On the terminal, get your IP address:</p>
<p>hostname -i</p>
<p>And your client host name:</p>
<p>hostname -a</p></td>
<td><p>In ParaView go on:</p>
<p>File → Connect → Add Server</p>
<p>And fulfil the fields in this way</p>
<table>
<thead>
<tr class="header">
<th>Name</th>
<th>&lt;<strong>serverPublicIPAddress</strong>&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Server type</td>
<td>Client/Server</td>
</tr>
<tr class="even">
<td>Port</td>
<td>11111</td>
</tr>
</tbody>
</table>
<table>
<tbody>
<tr class="odd">
<td>Configure</td>
<td>Manual startup</td>
</tr>
</tbody>
</table>
<p>Port 11111 is the default TCP port for the ParaView connection, if this port is occupied from another service you can set up another port accordingly with the server setting.</p>
<table>
<tbody>
<tr class="odd">
<td>Connect</td>
</tr>
</tbody>
</table></td>
</tr>
</tbody>
</table>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="paraview-compilation"><a class="header" href="#paraview-compilation">ParaView compilation</a></h1>
<p>The build process follows the usual cmake scheme, from the root of your
source code:</p>
<pre><code class="language-sh">mkdir build
cd build
cmake ..         # Generate the build instrutions 
cmake --build .  # Start the compilation process
</code></pre>
<h2 id="paraview-plugins"><a class="header" href="#paraview-plugins">Paraview plugins</a></h2>
<p>If you need particular features from paraview it is necessaty to
build it from source. You'll need <code>cmake</code> to build the build instructions and <code>ninja</code> to execute the latter ones.
The instruction present at this source are usefull for this scope: <a href="https://vcg.iwr.uni-heidelberg.de/manual_source/">https://vcg.iwr.uni-heidelberg.de/manual_source/</a></p>
<h2 id="dependencies"><a class="header" href="#dependencies">Dependencies</a></h2>
<p>Assuming your system is Debian based the following libraries should be present in the system:</p>
<pre><code class="language-sh">sudo apt-get install libc6-i386 lib32stdc++6 lib32gcc1 lib32ncurses5 lib32z1
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="visualization-over-different-meshes"><a class="header" href="#visualization-over-different-meshes">Visualization over different meshes</a></h1>
<p>Once you have the same domain but with different meshes, often is neeeded a comparison between the 2 solutions.
mesh.</p>
<p><img src="paraview/image.png" alt="alt text" /></p>
<p>The filter (shortcut <code>Ctrl</code> + <code>space-bar</code>) <b> Resample with Dataset </b> provide a way to interpolate result into a different</p>
<p><img src="paraview/image-1.png" alt="alt text" /></p>
<h3 id="check-data-over-a-line"><a class="header" href="#check-data-over-a-line">Check data over a line</a></h3>
<p>Often it is necessary to display varibale trend over a line. Using the shortcut <code>Ctrl</code> + <code>space-bar</code>
you can rise the filer menu and type <b>Plot over line</b> This will ask to draw a line which is dificult to place.</p>
<p><img src="paraview/image-2.png" alt="alt text" /></p>
<p>The best way to use plot over line is through slicing the domain and the slice again the 2D plane on the location
of interest. The filter will automatically recognize the 1D domain resulted by the interesection of two planes.</p>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="post-processing-via-command-line"><a class="header" href="#post-processing-via-command-line">Post processing via command line</a></h1>
<p>An example to run the post process for y<sup>+</sup>sup&gt;+</sup></p>
<pre><code class="language-sh">&lt;solver&gt; -postProcess -func &lt;functionNameInControlDict&gt;
</code></pre>
<p>Every solver can be run with the -postProcess option, which only
executes post-processing, but with additional access to data available
on the database for the solver. To list the possible parameters to post
process:</p>
<pre><code class="language-sh">postProcess -list
</code></pre>
<p>An example on how "system/controlDict" shoud be set up to read a function:</p>
<pre><code class="language-c#">...

application     simpleFoam;

...

functions

{
    yPlusFunction
    {
        type            yPlus;
        libs            ("libfieldFunctionObjects.so");
        writeControl    writeTime;
        patches         (wall);
    }

}
</code></pre>
<h2 id="postprocess-utility"><a class="header" href="#postprocess-utility">Postprocess utility</a></h2>
<p>For a run-processing, or a complicated function postprocess where is
necessary state different parameters. The simulation must be furnished
with the function object (Function objects are utilities to ease
workflow configurations and enhance workflows by producing additional
user-requested data both during runtime and postprocessing calculations,
typically in the form of additional logging to the screen, or generating
text, image, and field files) in controlDict as follow:</p>
<pre><code class="language-c++">...
functions    // sub-dictionary name under the system/controlDict file
{
    &lt;userDefinedSubDictName1&gt;
    {
        // Mandatory entries
        type                &lt;functionObjectTypeName&gt;;
        libs                (&lt;libType&gt;FunctionObjects);

        // Mandatory entries defined in &lt;functionObjectType&gt;
        ...

        // Optional entries defined in &lt;functionObjectType&gt;
        ...

        // Optional (inherited) entries
        region              region0;
        enabled             true;
        log                 true;
        timeStart           0;
        timeEnd             1000;
        executeControl      timeStep;
        executeInterval     1;
        writeControl        timeStep;
        writeInterval       1;
    }

    &lt;userDefinedSubDictName2&gt;
    {
        ...
    }
    ...
}
</code></pre>
<p>To manage in a simply way the function field already calculated through
controlDict, (already written in the data folder); the command line for
the post processing is the follow; this example is about averaging the
heat transfer coefficient.</p>
<pre><code class="language-sh">postProcess -func 'patchAverage(name=wall, heatTransferCoeff(T))'
</code></pre>
<p>While to extract the pressure drop, run a command similar to the follow one:</p>
<pre><code class="language-sh">postProcess -func 'patchAverage(name=inlet, p)'
</code></pre>
<p>once it is know the pressure of the outlet you can subract it and obtain the delta pressure.</p>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="function-objects"><a class="header" href="#function-objects">Function Objects</a></h1>
<p>Function objects are essentially pre-built modules that empower users to monitor control
points, compute forces and coefficients, perform time-averaging of fields, extract surfaces and slices,
and much more — all in real-time and without requiring additional coding. These built-in utilities are defined
and loaded in <code>controlDict</code>. When leveraged effectively, function objects eliminate the necessity of storing
all run-time simulation data, leading to significant resource  savings. Here are some additional details on what
we use function objects for:</p>
<ul>
<li>Monitor probes : Probes are basically control points in your domain where values of certain fields are monitored
over simualtion time. This feature is particularly useful for tracking critical locations or assessing the behavior
of specific variables over time. For example, one can track statistical convergence using probes.</li>
<li>Calculate forces and force coefficients : Users can compute forces and force coefficients acting on surfaces or boundaries within the simulation domain. This capability is essential for analyzing fluid-structure interactions, aerodynamic performance, and other engineering phenomena. For example, wind load on buildings, drag and lift forces acting on an airfoil, and so on.</li>
<li>Calculate time-averaged fields : Function objects enable the calculation of time-averaged fields, providing insights into the steady-state behavior of the simulation. This is beneficial for understanding long-term trends and minimizing the influence of transient effects.</li>
<li>Extract slice information : Users can extract surfaces or slices from the computational domain using function objects. This functionality is valuable for visualizing specific regions of interest or exporting data for further analysis such as Proper Orthogonal Decomposition (POD), Dynamic Mode Decomposition (DMD), and so on.</li>
<li>Custom data processing : Beyond the built-in functionalities, function objects can be customized to perform user-defined data processing tasks. This flexibility allows users to tailor post-processing routines to their specific requirements, enhancing the utility of OpenFOAM for diverse applications.</li>
</ul>
<h2 id="how-to-use-function-objects"><a class="header" href="#how-to-use-function-objects">How to use Function Objects</a></h2>
<p>Function objects serve dual purposes:</p>
<ul>
<li>being employed during runtime within the simulation</li>
<li>accessed via command-line post-processing utilities</li>
</ul>
<p>Typically, function objects excel in runtime investigations, offering invaluable insights. To utilize
function objects, each selected function must be listed within the functions sub-dictionary of the <code>system/controlDict</code> file,
structured as a nested sub-dictionary, as illustrated in the following example:</p>
<pre><code class="language-c#">...

runTimeModifiable true;

functions
{
  &lt;userDefinedSubDictName2&gt;
    {
      ...
    }

  &lt;userDefinedSubDictNameN&gt;
  {
    ...
  }
}
</code></pre>
<p>Another approach to implementing function objects in controlDict is by including the file that contains them. For instance, if I define a probe function object file named probes or surfaces function objec file, I can include it in controlDict as shown below:</p>
<pre><code class="language-c#">functions
{
  #includeFunc probes
  #includeFunc surfaces
}
</code></pre>
<h3 id="example-1"><a class="header" href="#example-1">Example</a></h3>
<p>List of useful OpenFOAM function objects</p>
<h4 id="probes"><a class="header" href="#probes">probes</a></h4>
<p>Function object to monitor pressure and velocity at critical points across the domain.</p>
<pre><code class="language-c#">probes
{
    type            probes;
    libs            ("libsampling.so");

    // Name of the directory for probe data
    name            probes;

    // Write at same frequency as fields
    writeControl    timeStep;
    writeInterval   1;

fields (
        p 
        U 
       );

probeLocations
(

	(0.03 0.006 0.006)
	(0.03 0.006 0)
	(0.03 0.006 -0.006)
	
);
    // Optional: filter out points that haven't been found. Default
    //           is to include them (with value -VGREAT)
    includeOutOfBounds  true;
}
</code></pre>
<h4 id="fieldaverage"><a class="header" href="#fieldaverage">fieldAverage</a></h4>
<p>Function object to calculate the time-averaged pressure and velocity fields, as well as their root-mean-squared covarience.</p>
<pre><code class="language-c#">fieldAverage
    {
        type            fieldAverage;
        libs            ("libfieldFunctionObjects.so");
        writeControl    writeTime;
        timeStart       0;

        fields
        (
            U
            {
                mean        on;
                prime2Mean  on;
                base        time;
            }

            p
            {
                mean        on;
                prime2Mean  on;
                base        time;
            }
        );
    }
</code></pre>
<h4 id="forces--forcecoeffs"><a class="header" href="#forces--forcecoeffs">forces / forceCoeffs</a></h4>
<p>Function object to calculate the force and force coefficient on any projected surface.</p>
<pre><code class="language-c#">forces1
    {
        type            forces;
        libs            (forces);
        writeControl   timeStep;
        writeInterval  1;

        patches         ( "PRISM" );
        CofR            (0 0 0);

        rho             rhoInf;
        log             true;
        rhoInf          1.225;
    }

forceCoefficients
    {
        type            forceCoeffs;
        libs ( "libforces.so" );
    
        writeControl   timeStep;
        writeInterval  1;
        
        patches         ( "PRISM" );
        
        rho             rhoInf;
        log             true;
        rhoInf          1.225;
        liftDir         (0 1 0);
        dragDir         (1 0 0);
        //sideDir         (0 0 1);
        CofR            (0 0 0);
        pitchAxis       (0 0 1);
        magUInf         0.015;
        lRef            0.1;
        Aref            0.0628;
    }
</code></pre>
<h4 id="vorticity"><a class="header" href="#vorticity">vorticity</a></h4>
<p>Function object to calculate the curl of velocity:</p>
<pre><code class="language-c#">vorticity
    {
        // Mandatory entries
        type            vorticity;
        libs            (fieldFunctionObjects);

        // Optional (inherited) entries
        field           U;
        result          vorticityField;
        region          region0;
        enabled         true;
        log             true;
        executeControl  timeStep;
        executeInterval 1;
        writeControl    timeStep;
        writeInterval   42;
    }
</code></pre>
<h4 id="lambda2"><a class="header" href="#lambda2">Lambda2</a></h4>
<p>Function object used to identify vortex cores.</p>
<pre><code class="language-c#">Lambda2
{
    // Mandatory entries
    type            Lambda2;
    libs            (fieldFunctionObjects);

    // Optional (inherited) entries
    field           U;
    result          Lambda2Field;
    region          region0;
    enabled         true;
    log             true;
    executeControl  timeStep;
    executeInterval 42;
    writeControl    timeStep;
    writeInterval   42;
}
</code></pre>
<h4 id="subtract"><a class="header" href="#subtract">Subtract</a></h4>
<p>Function object to calculate the turbulence intensity, i.e. the fluctuating component of velocity.</p>
<pre><code class="language-c#">subtract
{
    // Mandatory entries
    type            subtract;
    libs            (fieldFunctionObjects);
    fields          (U UMean);

    // Optional (inherited) entries
    result          uPrime;
    region          region0;
    enabled         true;
    log             true;
    executeControl  timeStep;
    executeInterval 1;
    writeControl    timeStep;
    writeInterval   42;
}
</code></pre>
<h4 id="surfaces"><a class="header" href="#surfaces">surfaces</a></h4>
<p>Function object to extract field data at specified planes.</p>
<pre><code class="language-c#">surfaces
{
    type            surfaces;
    libs            ("libsampling.so");
    writeControl    writeTime;

    surfaceFormat   vtk;
	
	formatOptions
	{
		vtk
		{
			legacy true;
			format ascii;
		} 
	}
	
    fields          (p U);

    interpolationScheme cellPoint;

    surfaces
    {
        zNormal
        {
            type        cuttingPlane;
            point       (0 0 0);
            normal      (0 0 1);
            interpolate true;
        }

              yNormal
        {
            type        cuttingPlane;
            point       (0 0.005 0);
            normal      (0 1 0);
            interpolate true;
        }
    };
}
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="petsc-linear-algebra-solver"><a class="header" href="#petsc-linear-algebra-solver">PETSc linear algebra solver</a></h1>
<p>The <a href="https://petsc.org/">PETSc</a> library can be used to resolve linear system of equations assembled by
the OpenFOAM routines.</p>
<p>PETSc is installed (the target is the object <code>libpetsc.so</code>) setting the library path (<code>LDPATH</code>) specifing the
environment variables set to the petsc installation:</p>
<ul>
<li><b>PETSC_DIR</b></li>
<li><b>PETSC_ARCH</b></li>
</ul>
<p>The above env. variables are needed to compile and link the PETSc library.</p>
<h3 id="compilation-of-the-solver"><a class="header" href="#compilation-of-the-solver">Compilation of the solver</a></h3>
<p>An OpenFOAM compatability layer must be created to allow the comunication from OpenFOAM to PETSc,
hence a library must be generated:</p>
<pre><code class="language-sh">cd $WM_PROJECT_DIR/module/external_solver
./Allwmake -config=openfoam
</code></pre>
<p>Then check the following</p>
<pre><code class="language-sh">foamHasLibrary -verbose petscFoam
</code></pre>
<p>And try out one of the prepared tutorial cases:</p>
<pre><code class="language-sh">cd $WM_PROJECT_DIR/module/external_solver/tutorial
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html><div style="break-before: page; page-break-before: always;"></div><h1 id="text-editors"><a class="header" href="#text-editors">Text editors</a></h1>
<p>To edit text (especially in HPC remote sessions), a GUI will not be always available.
As a consequence software able to manage text efficiently directly on the terminal are
necessary.</p>
<div class="table-wrapper"><table><thead><tr><th>Software name</th><th>Destination of use</th><th>Why</th></tr></thead><tbody>
<tr><td>micro</td><td>Dictionary editing</td><td>Easy to use and common shortcuts</td></tr>
<tr><td>vim</td><td>Code editing</td><td>Tons extentions and good sintax highlighting</td></tr>
</tbody></table>
</div>
<p>Debian based systems can install those software via:</p>
<pre><code class="language-sh">sudo apt install micro vim
</code></pre>
<h2 id="windows-text-editors"><a class="header" href="#windows-text-editors">Windows text editors</a></h2>
<p>Here there is a list of useful programmes that are available for Windows system</p>
<h3 id="notepad-"><a class="header" href="#notepad-">NotePad ++</a></h3>
<p>If you are in a Windows environment, we suggest using NotePad++ as a
default text editor.</p>
<p>A single modification must be apported since writing script in this
environment can cause crashes due to a different treatment of invisible
character for Windows or UNIX. Operate this mod to make the file
readable without trouble in GNU-Linux:</p>
<p>NotePad++ → Edit → EOL conversion →  UNIX</p>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="virtualization"><a class="header" href="#virtualization">Virtualization</a></h1>
<p>This is a problme that is expecially present for Windows or Mac-OS user, since it must
be used a virtual system to simulate a GNU-Linux environment. Here there are two choices
in order features completeness.</p>
<ul>
<li>WSL: for Windows system</li>
<li>Multipass: for Windows system</li>
<li>Docker: for Mac-OS user</li>
</ul>
<h3 id="nb"><a class="header" href="#nb">NB</a></h3>
<p>Docker can be used in Windows as well however it is retained a more poliedric working tool a
stable virtual machine as the one Canonical has developed for Windows.</p>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="windows-subsystem-for-gnu-linux"><a class="header" href="#windows-subsystem-for-gnu-linux">Windows Subsystem for GNU-Linux</a></h1>
<p>OpenFoam<sup>®</sup> can run on version 2 of WSL. Few installation notes before installing it:,
run in PowerShell as adminthe followings for the enabling a necessary Windows feature:</p>
<pre><code class="language-sh">dism.exe /online /enable-feature /featurename:VirtualMachinePlatform
/all /norestart
</code></pre>
<p>The proceed with the installation:</p>
<pre><code class="language-sh">wsl –install
</code></pre>
<p>After having prepared the environment, download from the Windows Store the GNU/Linux
distribution you would like to work on. Then, once installed, The GNU-Linux root folder
is in the Windows file explorer in:</p>
<pre><code class="language-sh">\\wsl$\Ubuntu-20.04\
</code></pre>
<p>Change the distribution name accordingly to the distribution you have chosen to run.</p>
<h2 id="gui-applications"><a class="header" href="#gui-applications">GUI applications</a></h2>
<p>To lunch GUI programmes via WSL the following actions must take place:
Install an Xserver like VcXsrv, download from
<a href="https://sourceforge.net/projects/vcxsrv/">https://sourceforge.net/projects/vcxsrv/ 782</a>
and install/start it. Specifying the server numer to be ‘0’ on the first
screen and also allow public access such as:</p>
<pre><code class="language-sh">Disable Windows Defender Firewall for Guest or public Network
</code></pre>
<p>In WSL edit the file shell confing file in this way:</p>
<pre><code class="language-sh">export DISPLAY=$(grep -m 1 nameserver /etc/resolv.conf | awk '{print $2}'):0.0 &gt;&gt; ~/.bashrc
</code></pre>
<h2 id="storage-reclaim"><a class="header" href="#storage-reclaim">Storage reclaim</a></h2>
<p>Shirnking the storage has been a problem for WSL instances and they can clog the storage of
the entire system. Given that you have reduced the size of the content inside the WSL it is
adviced to do the following in powershell to get back the storage:</p>
<pre><code class="language-sh">wsl.exe --shutdown
cd C:\Users\&lt;User&gt;\AppData\Local\Packages\CanonicalGroupLimited.Ubuntu_79rhkp1fndgsc\LocalState
optimize-vhd -Path .\ext4.vhdx -Mode full
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="multipass"><a class="header" href="#multipass">Multipass</a></h1>
<p>If you need to use VMs in your machine together with Docker, WSL could
not be the best choice since it can create dependencies problem, and one
of the virtual environment above citated will not work at the current
time. A solution for the coexistence of container and VM in your machine
is the usage of Multipass</p>
<p>Multipass is a VM supplied by Canonical which is powerful and contain
systemd. To start a multipass instance run on the Power Shell:</p>
<p>multipass launch -v -c 18 -d 64G -m 40G –-name &lt;nameOfTheInstance&gt;</p>
<p>Few comments on the flags:</p>
<ul>
<li>c → CPU cores</li>
<li>d → Disk space</li>
<li>m → Memory</li>
<li>v → Verbose</li>
</ul>
<p>To mount a part of your file system in your virtual multipass machine
execute this command in powershell:</p>
<pre><code class="language-sh"># In this case D:\\ is the name of the disk I would like to mout on the virtual machine
multipass mount 'D:\\' &lt;nameOfTheInstance&gt;
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="docker"><a class="header" href="#docker">Docker</a></h1>
<p>Docker is an open-source software for automating and encapsulating the
deployment of applications inside software containers.</p>
<p>It works with images and container, the main difference between this two is:</p>
<ul>
<li>An image is chunk of memory allocated to store an OS and the relative applicaiton data</li>
<li>A container instead is a running image</li>
</ul>
<p>To visualise how many images you have in your system run:</p>
<pre><code class="language-sh">docker images
</code></pre>
<h2 id="system-images"><a class="header" href="#system-images">System images</a></h2>
<p>An image becomes a container when you execute it. Check the images that are present in your system after the build
docker images, the command to build an image is:</p>
<pre><code class="language-sh">docker build &lt;DirectoryWhereTheDockerfileIsLocated&gt;
</code></pre>
<p>First create a docker file, which is a file named <code>Dockerfile</code> with a content similar to the followng
script snippet (depending on your esigence) on which will be build a docker image that will become a container once is
running.</p>
<pre><code class="language-sh"># Start from the official Ubuntu official image in DockeHub (last LTS version)
FROM ubuntu:latest    

# Setting the environment variable 
ENV DEBIAN_FRONTEND=noninteractive

# Install any extra things we might need
RUN apt-get update \
	&amp;&amp; apt-get install -y micro curl sudo bc python3 

# Create a new user called of-user
RUN useradd --user-group --create-home --shell /bin/bash of-user ;\
	echo "of-user ALL=(ALL) NOPASSWD:ALL" &gt;&gt; /etc/sudoers

# Install OpenFOAM v2112 (without ParaView) including configuring for use by user=of-user plus an extra environment variable to make OpenMPI play nice
RUN curl -s https://dl.openfoam.com/add-debian-repo.sh | bash ;\
	apt-get install -y openfoam2112 ;\
	rm -rf /var/lib/apt/lists/* ;\
	echo "source /usr/lib/openfoam/openfoam2112/etc/bashrc" &gt;&gt; ~of-user/.bashrc ;\
	echo "export OMPI_MCA_btl_vader_single_copy_mechanism=none" &gt;&gt; ~of-user/.bashrc;  # By setting OMPI_MCA_btl_vader_single_copy_mechanism to none, you are disabling a specific feature or mechanism called "vader single copy mechanism" used by Open MPI for efficient communication between processes.

#   Set the default container user to of-user
USER of-user

#ENTRYPOINT ["/data/run.sh"]
</code></pre>
<p>To build the image from the <code>Dockerfile</code> use:</p>
<pre><code class="language-sh">docker build -t &lt;nameOfTheImage&gt; &lt;DockerfileDirectory&gt;
</code></pre>
<h2 id="running-the-container"><a class="header" href="#running-the-container">Running the container</a></h2>
<p>Running the container means that the docker file will be read and executed, the execution
can be modified by the flags that follows the utility such as:</p>
<pre><code class="language-sh">docker run -ti -–rm &lt;imageID&gt;
</code></pre>
<p>Here's some more info on the flags:</p>
<ul>
<li>ti       →  make you access to the terminal</li>
<li>rm       →  remove the container once you exit</li>
<li>d        →  (deamon) run the container in detached mode (in the background)</li>
<li>p 80:80  →  port exposition, the local OS can connect to the docker image via port 80</li>
</ul>
<p>To see if the container is running check:</p>
<pre><code class="language-sh">docker ps
</code></pre>
<p>Then to start and/or stop the container run the following self explatory commands:</p>
<pre><code class="language-sh">docker start &lt;imageID&gt;
docker stop &lt;imageID&gt;
</code></pre>
<h3 id="mount-a-file-system-directory-inside-a-docker-container"><a class="header" href="#mount-a-file-system-directory-inside-a-docker-container">Mount a file system directory inside a docker container</a></h3>
<p>Do not store your simulation data in the container. Instead let’s give our
container access to just a little bit of our local filesystem. From your project
directory in a Windows environment, run:</p>
<pre><code class="language-sh">docker run -ti --rm -v ${PWD}:/data -w /data &lt;imageID&gt;
</code></pre>
<p>By adding the -v option we’re asking Docker to mount our current working directory
($PWD) as /data in the container. We’ve also added the -w switch to tell Docker
that we’d like to be in /data when the container starts.</p>
<h2 id="creating-an-image-from-a-container"><a class="header" href="#creating-an-image-from-a-container">Creating an image from a container</a></h2>
<p>You can convert a container into an image by using the command</p>
<pre><code class="language-sh">docker commit 
</code></pre>
<h2 id="delete-container"><a class="header" href="#delete-container">Delete container</a></h2>
<p>The following command will delete the container:</p>
<pre><code class="language-sh">docker ps			  	   # To visualise them
docker rmi &lt;imageID&gt;
</code></pre>
<p>Or you can delete all of them piping two commands:</p>
<pre><code class="language-sh">docker rm -vf $(docker ps -aq)
</code></pre>
<h2 id="delete-images"><a class="header" href="#delete-images">Delete images</a></h2>
<p>To delete the images that does not run a container above them run;</p>
<pre><code>docker images  				# To visualise them
docker image rm &lt;imageID&gt;
</code></pre>
<p>Or you can delete all of them piping two commands:</p>
<pre><code class="language-sh">docker rmi -f $(docker images -aq)
</code></pre>
<h2 id="reclaim-space-from-machine"><a class="header" href="#reclaim-space-from-machine">Reclaim space from machine</a></h2>
<p>Docker saves container chaces on <code>var/lib/docker</code>, this can clog the machine disk if
there is not enough storage available. A quick solution is to run the following command
to clean the system cache:</p>
<pre><code class="language-sh">docker system prune -a -f
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="docker-compose"><a class="header" href="#docker-compose">Docker compose</a></h1>
<p>Docker Compose is a tool for running multi-container applications on Docker defined using
the Compose file format. A Compose file is used to define how one or more containers that
make up your application are configured, such as:</p>
<pre><code class="language-yml">version: '3.4'

services:
  restsvr:
    image: imageName
    ports:
      - 443:8000
    build:
      context: .
      dockerfile: ./Dockerfile

    logging:
      driver: "json-file"
      options:
        max-size: "100m"
        max-file: "5"
</code></pre>
<p>Once you have a Compose file, you can create and start your application with a single command:</p>
<pre><code class="language-sh">docker-compose up --build -d
</code></pre>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>
<div style="break-before: page; page-break-before: always;"></div><h1 id="navier-stokes-equations"><a class="header" href="#navier-stokes-equations">Navier-Stokes Equations</a></h1>
<p>These equations are usually displayed following two different notation systems.</p>
<h2 id="einstein-summation-notation"><a class="header" href="#einstein-summation-notation">Einstein summation notation</a></h2>
<p>The Einstein summation convention dictates that:</p>
<p>\begin{equation}
\tag{1}
\frac{\partial \rho}{\partial t} + \frac{\partial(\rho u_{i})}{\partial x_{i}} = 0
\end{equation}</p>
<p>\begin{equation}
\tag{2}
\frac{\partial (\rho u_{i})}{\partial t} + \frac{\partial[\rho u_{i}u_{j}]}{\partial x_{j}} = -\frac{\partial p}{\partial x_{i}} + \frac{\partial \tau_{ij}}{\partial x_{j}} + \rho f_{i}
\end{equation}</p>
<p>\begin{equation}
\tag{3}
\frac{\partial (\rho e)}{\partial t} + (\rho e+p)\frac{\partial u_{i}}{\partial x_{i}} = \frac{\partial(\tau_{ij}u_{j})}{\partial x_{i}} + \rho f_{i}u_{i} + \frac{\partial(\dot{ q_{i}})}{\partial x_{i}} + r
\end{equation}</p>
<p>When a sub-indice (here
<em>i</em> or <em>j</em>) is twice or more repeated in the same equation, one sums
across the n-dimensions. This means, in the context of Navier-Stokes in
3 spacial dimensions, that one repeats the term 3 times, each time
changing the indice for one representing the corresponding dimension (i.e.
<em>1,2,3</em> or <em>x,y,z</em>). <em>Equation 1</em> is therefore a shorthand representation
of:</p>
<p>\begin{equation}
\frac{\partial \rho}{\partial t}+\frac{\partial(\rho u_{1})}{\partial x_{1}}+\frac{\partial(\rho u_{2})}{\partial x_{2}}+ \frac{\partial(\rho u_{3})}{\partial x_{3}}=0
\end{equation}</p>
<p><em>Equation 2</em> is actually a superposition of 3 separable equations which
could be written in a 3-line form: one line equation for each <em>i</em> in
each of which one sums the three terms for the <em>j</em> sub-indices.</p>
<h2 id="classic-notation"><a class="header" href="#classic-notation">Classic notation</a></h2>
<p>In a classic notation the equation make use of ⟶,⊗,∇ symbology to define the eqution structure;</p>
<p>\begin{equation}
\tag{4}
\frac{\partial \rho}{\partial t} + \overrightarrow{\nabla}\cdot(\rho\overrightarrow{u})=0
\end{equation}</p>
<p>\begin{equation}
\tag{5}
\frac{\partial(\rho \overrightarrow{u})}{\partial t} + \overrightarrow{\nabla}\cdot[\rho\overline{\overline{u\otimes u}}] = -\overrightarrow{\nabla p} + \overrightarrow{\nabla}\cdot\overline{\overline{\tau}} + \rho\overrightarrow{f}
\end{equation}</p>
<p>\begin{equation}
\tag{6}
\frac{\partial(\rho e)}{\partial t} + \overrightarrow{\nabla}\cdot((\rho e + p)\overrightarrow{u}) = \overrightarrow{\nabla}\cdot(\overline{\overline{\tau}}\cdot\overrightarrow{u}) + \rho\overrightarrow{f}\overrightarrow{u} + \overrightarrow{\nabla}\cdot(\overrightarrow{\dot{q}})+r
\end{equation}</p>
<p>Here ⊗ denotes the tensorial product, forming a tensor from the
constituent vectors. A double bar denotes a tensor. The three equations
(<em>4,5,6</em>) are equivalent to (<em>1,2,3</em>).</p>
<!--  Script to show the footer   -->
<html>
<script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous">
</script>
<script>
$(function(){
  $("#footer").load("../footers/footer_first_level_depth.html");
});
</script>
<body>
<div id="footer"></div>
</body>
</html>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="ace.js"></script>
        <script src="editor.js"></script>
        <script src="mode-rust.js"></script>
        <script src="theme-dawn.js"></script>
        <script src="theme-tomorrow_night.js"></script>

        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>

    </div>
    </body>
</html>
